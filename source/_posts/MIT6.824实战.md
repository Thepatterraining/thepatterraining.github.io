---
title: MySQLé›¶åŸºç¡€æ•™ç¨‹è¡¨è®¾è®¡å®æˆ˜
date: 2025-03-18 10:12:47
tags: ['æ•°æ®åº“','æ•°æ®åº“åŸç†','sql','mysql']
category: mysql
article: MySQLé›¶åŸºç¡€æ•™ç¨‹è¡¨è®¾è®¡å®æˆ˜
---

> å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¤§å¤´ï¼ŒèŒé«˜æ¯•ä¸šï¼Œç°åœ¨å¤§å‚èµ„æ·±å¼€å‘ï¼Œå‰ä¸Šå¸‚å…¬å¸æ¶æ„å¸ˆï¼Œç®¡ç†è¿‡10äººå›¢é˜Ÿï¼
> æˆ‘å°†æŒç»­åˆ†äº«æˆä½“ç³»çš„çŸ¥è¯†ä»¥åŠæˆ‘è‡ªèº«çš„è½¬ç ç»éªŒã€é¢è¯•ç»éªŒã€æ¶æ„æŠ€æœ¯åˆ†äº«ã€AIæŠ€æœ¯åˆ†äº«ç­‰ï¼
> æ„¿æ™¯æ˜¯å¸¦é¢†æ›´å¤šäººå®Œæˆç ´å±€ã€æ‰“ç ´ä¿¡æ¯å·®ï¼æˆ‘è‡ªèº«çŸ¥é“èµ°åˆ°ç°åœ¨æ˜¯å¦‚ä½•è‰°éš¾ï¼Œå› æ­¤è®©ä»¥åçš„äººå°‘èµ°å¼¯è·¯ï¼
> æ— è®ºä½ æ˜¯ç»Ÿæœ¬CSä¸“ä¸šå‡ºèº«ã€ä¸“ç§‘å‡ºèº«ã€è¿˜æ˜¯æˆ‘å’Œä¸€æ ·èŒé«˜æ¯•ä¸šç­‰ã€‚éƒ½å¯ä»¥è·Ÿç€æˆ‘å­¦ä¹ ï¼Œä¸€èµ·æˆé•¿ï¼ä¸€èµ·æ¶¨å·¥èµ„æŒ£é’±ï¼
> å…³æ³¨æˆ‘ä¸€èµ·æŒ£å¤§é’±ï¼æ–‡æœ«æœ‰æƒŠå–œå“¦ï¼

> å…³æ³¨æˆ‘å‘é€â€œMySQLçŸ¥è¯†å›¾è°±â€é¢†å–å®Œæ•´çš„MySQLå­¦ä¹ è·¯çº¿ã€‚
> å‘é€â€œç”µå­ä¹¦â€å³å¯é¢†å–ä»·å€¼ä¸Šåƒçš„ç”µå­ä¹¦èµ„æºã€‚
> å‘é€â€œå¤§å‚å†…æ¨â€å³å¯è·å–äº¬ä¸œã€ç¾å›¢ç­‰å¤§å‚å†…æ¨ä¿¡æ¯ï¼Œç¥ä½ è·å¾—é«˜è–ªèŒä½ã€‚
> å‘é€â€œAIâ€å³å¯é¢†å–AIå­¦ä¹ èµ„æ–™ã€‚

# MIT6.824

ä½ åœ¨å°è¯•æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹å‰ï¼Œåº”è¯¥å…ˆå°è¯•å•æœºç³»ç»Ÿï¼Œå¦‚æœèƒ½æ»¡è¶³çš„è¯ä¸è¦æåˆ†å¸ƒå¼ã€‚

å› ä¸ºå•æœºç³»ç»Ÿæ¯”åˆ†å¸ƒå¼ç®€å•çš„å¤šã€‚

åˆ†å¸ƒå¼çš„åŸå› æ˜¯éœ€è¦è·å¾—æ›´é«˜çš„æ€§èƒ½ã€æŸç§å¹¶è¡Œæ€§ã€å¤§é‡çš„CPUã€å¤§é‡çš„å†…å­˜ã€å¤§é‡çš„ç£ç›˜ã€‚å¦ä¸€ä¸ªåŸå› æ˜¯å®¹å¿æ•…éšœï¼Œä¸€ä¸ªæœºå™¨æŒ‚äº†è¿˜æœ‰åˆ«çš„æœºå™¨æä¾›æœåŠ¡ã€‚
è¿˜æœ‰äº›å¯èƒ½æ˜¯è‡ªç„¶çš„ç‰©ç†åˆ†å¸ƒå¼ï¼Œæ¯”å¦‚é“¶è¡Œå¤šä¸ªåœ°æ–¹çš„è½¬è´¦ã€‚è¿˜æœ‰å®‰å…¨æ€§ï¼Œå¯ä»¥éš”ç¦»å‡ºç¯å¢ƒè¿è¡Œä»£ç ã€‚æ¥ä¿è¯ä¸»ç¯å¢ƒçš„å®‰å…¨ã€‚

åˆ†å¸ƒå¼ç³»ç»Ÿçš„æŒ‘æˆ˜
- å¹¶å‘æ€§
- éƒ¨åˆ†æ•…éšœ
- æ€§èƒ½

æœ¬è¯¾ç¨‹çš„ç›®æ ‡æ˜¯æ„å»ºé¢å‘åº”ç”¨ç¨‹åºçš„åŸºç¡€è®¾æ–½ï¼š
- å­˜å‚¨
- ç½‘ç»œé€šä¿¡
- è®¡ç®—

> ä¸»è¦ç›®çš„ä¸ºæŠ½è±¡è¿™äº›èƒ½åŠ›ç»™å¤–éƒ¨åº”ç”¨æä¾›æ¥å£ï¼Œéšè—å†…éƒ¨çš„åˆ†å¸ƒå¼å®ç°ã€‚

ä¸€äº›å·²æœ‰çš„å®ç°ç¤ºä¾‹ï¼š
- RPCï¼šéšè—äº†é€šä¿¡èƒ½åŠ›
- Threadï¼šéšè—äº†å¤šæ ¸æ“ä½œç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›

æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„`é«˜å±‚æ¬¡`çš„ç›®æ ‡ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆéš¾ï¼š
1. å¯æ‰©å±•æ€§ï¼ˆï¼‰ï¼šç³»ç»Ÿçš„æ¨ªå‘æ‰©å±•èƒ½åŠ›ï¼Œç†æƒ³æƒ…å†µæ˜¯åŠ nå°æœºå™¨å¯ä»¥è·å¾—nå°æœºå™¨çš„æ€§èƒ½ã€‚
2. å®¹é”™æ€§ï¼ˆFault Rableï¼‰ï¼š
    - å¯ç”¨æ€§ï¼šç³»ç»Ÿçš„é«˜å¯ç”¨èƒ½åŠ›ï¼Œå¦‚æœæœ‰å¤šä¸ªæœºå™¨çš„è¯ï¼Œå½“ä¸€ä¸ªæœºå™¨æŒ‚äº†ï¼Œè¿˜æœ‰å…¶ä»–æœºå™¨å¯ä»¥æä¾›æœåŠ¡ï¼Œä¿è¯ç³»ç»Ÿå¯ç”¨ã€‚
    - æ•…éšœæ¢å¤æ€§ï¼šå½“æ•…éšœæ¢å¤ä»¥åï¼Œç³»ç»Ÿå¯ä»¥å’Œæ•…éšœæ¢å¤ä¹‹å‰ä¸€æ ·è¿è¡Œï¼Œæ²¡æœ‰æ•°æ®æŸå¤±ç­‰ã€‚å¯ä»¥é€šè¿‡`å¤åˆ¶`çš„èƒ½åŠ›å®ç°ï¼Œå­˜å‚¨å¤šä¸ªæ•°æ®å‰¯æœ¬ã€‚
3. ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šè¯­ä¹‰æ˜¯å½“put(k,v)ä»¥åï¼Œä¸€å®šä¼šget(k)èƒ½å¾—åˆ°vã€‚ä½†æ˜¯å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´è¿™æ˜¯ä¸ä¸€å®šçš„ã€‚
    - å¼ºä¸€è‡´æ€§
    - å¼±ä¸€è‡´æ€§

## MapReduce

æœ€å¼€å§‹æ˜¯Googleæå‡ºçš„MapReduceï¼Œè¿™ç¯‡è®ºæ–‡å¯ä»¥è¿½æº¯åˆ°2004å¹´ã€‚æœ‰å…´è¶£çš„å¯ä»¥é˜…è¯»è¿™ä¸ªè®ºæ–‡ï¼šhttp://nil.csail.mit.edu/6.824/2020/papers/mapreduce.pdf

å½“æ—¶Googleé¢ä¸´çš„é—®é¢˜æ˜¯è¦å¯¹æ•°TBçš„æ•°æ®è¿›è¡Œè®¡ç®—ã€‚å› ä¸ºä»–ä»¬è¦ä»æµ·é‡çš„æ•°æ®ä¸­æ‰¾å‡ºä¼˜å…ˆçº§æœ€é«˜çš„é¡µé¢å±•ç¤ºå‡ºæ¥ã€‚

ä»–ä»¬è¿«åˆ‡çš„å¸Œæœ›ç”¨æ•°åƒå°è®¡ç®—æœºæ¥å…±åŒå®Œæˆï¼Œæ¥åŠ é€Ÿè¿™ä¸ªå·¥ä½œï¼Œè€Œä¸æ˜¯ç”¨ä¸€å°è®¡ç®—æœºç‹¬ç«‹å®Œæˆã€‚

MapReduceå¸Œæœ›å¼€å‘è€…åªéœ€è¦ç¼–å†™`Map`å‡½æ•°å’Œ`Reduce`å‡½æ•°ï¼Œå…¶ä»–çš„äº¤ç»™MapReduceæ¡†æ¶æ¥åšã€‚å°†è¿™äº›å‡½æ•°æ”¾åˆ°æ— æ•°çš„è®¡ç®—æœºä¸Šæ‰§è¡Œã€‚

æ ¸å¿ƒæ€æƒ³ï¼šå°†è¾“å…¥åˆ†æˆå¤šä»½ï¼Œäº§ç”Ÿå¤šä¸ªè¾“å…¥ã€‚å¹¶å¯¹æ¯ä¸ªè¾“å…¥è°ƒç”¨Mapå‡½æ•°ã€‚

### Map

Mapå‡½æ•°å°†è¾“å…¥å†…å®¹è¿›è¡Œå¤„ç†ï¼Œè¾“å‡ºä¸€ç»„key=>valueç»“æ„ã€‚ä½ å¯ä»¥æŠŠ Map ç†è§£æˆ`åˆ†ç±»å¤„ç†`çš„è¿‡ç¨‹ã€‚

ç¤ºä¾‹1ï¼šMapå°†ä»è¾“å…¥ä¸­ç»Ÿè®¡æ¯ä¸ªè‹±æ–‡å­—æ¯å‡ºç°çš„æ¬¡æ•°ã€‚

```
Input1 => Map => è¾“å‡ºï¼ša:1, b:2, c:0
Input2 => Map => è¾“å‡ºï¼ša:0, b:1, c:1
Input3 => Map => è¾“å‡ºï¼ša:1, b:0, c:0
```

ç®€åŒ–çš„Mapå‡½æ•°å¦‚ä¸‹ï¼š
Mapå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œkæ˜¯æ–‡ä»¶åç§°ï¼Œvæ˜¯æ–‡ä»¶å†…å®¹
```java
split file // æ‹†åˆ†æ–‡ä»¶å†…å®¹
Map(k, v){
    // å¾ªç¯è¾“å‡ºæ¯ä¸ªå­—æ¯
    for(w:words) {
        //3. è¾“å‡ºæ ¼å¼åŒæ ·æ˜¯k=ã€‹vï¼Œkæ˜¯å­—æ¯ï¼Œvæ˜¯å‡ºç°æ¬¡æ•°ã€‚
        // emitå‡½æ•°æ˜¯è¾“å‡ºå‡½æ•°ï¼Œç”±MapReduceæ¡†æ¶æä¾›
        // ä¸ºä»€ä¹ˆè¾“å‡º1ï¼Ÿå› ä¸ºæ˜¯ç®€å•çš„è®¡æ•°ï¼Œæ¯ä¸ªå­—æ¯å‡ºç°1æ¬¡
        emit(w,1);
    }
}

// å®é™…è¾“å‡ºç»“æœï¼ša:1, b:1, b:1
```

### Reduce

å¯¹ `Map` é˜¶æ®µäº§ç”Ÿçš„é”®å€¼å¯¹ï¼ŒæŒ‰ `key` åˆ†ç»„å¹¶èšåˆå¤„ç†ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚

ä½ å¯ä»¥æŠŠ `Reduce` ç†è§£æˆ`å¯¹åŒä¸€ç±»çš„ä¸œè¥¿åšæ€»ç»“`çš„è¿‡ç¨‹ã€‚

è€ŒReduceå‡½æ•°åŒæ ·æ¥æ”¶è¾“å…¥ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„Reduceå‡½æ•°å¯ä»¥æ¥æ”¶æŸä¸€ä¸ªå­—æ¯å’Œå‡ºç°çš„æ¬¡æ•°åšä¸ºè¾“å…¥ï¼Œè¾“å‡ºæ€»çš„å‡ºç°æ¬¡æ•°ã€‚æ¯”å¦‚ï¼š

```
Input1 (a:1, a:0, a:1) => Reduce => è¾“å‡ºï¼ša:2
Input2 (b:2, b:1, b:0) => Reduce => è¾“å‡ºï¼šb:3
Input3 (c:0, c:1, c:0) => Reduce => è¾“å‡ºï¼šc:1
```

ç®€åŒ–çš„Reduceå‡½æ•°å¦‚ä¸‹ï¼š
Reduceå‡½æ•°åŒæ ·æ¥æ”¶æ–‡ä»¶åšä¸ºè¾“å…¥ã€‚
```java
// reduceå‡½æ•°çš„è¾“å…¥ï¼Œkæ˜¯ç”¨æ¥èšåˆçš„keyï¼Œåœ¨è¿™é‡Œï¼Œè¿™ä¸ªkå°±æ˜¯å­—æ¯ï¼Œå¯èƒ½æ˜¯a,b,cã€‚å¯¹äºè®¡ç®—æ¥è¯´ï¼Œç”¨ä¸åˆ°è¿™ä¸ªkï¼Œvæ˜¯mapè¾“å‡ºçš„å€¼çš„listã€‚
// æ¯”å¦‚a:1, a:0, a:1, kæ˜¯a, væ˜¯[1,1]
Reduce(k, v) {
    // ç›´æ¥è¾“å‡ºè®¡æ•°å³å¯ å› ä¸ºlistçš„é•¿åº¦å°±æ˜¯è®¡æ•°ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ªå€¼éƒ½æ˜¯1.
    emit(len(v));
}
```

è¿™æ ·å°±è®¡ç®—å‡ºäº†æ‰€æœ‰è¾“å‡ºä¸­ï¼Œabcä¸‰ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•°ã€‚

æœ€å¦™çš„è®¾è®¡åœ¨äºï¼ŒæŒ‰ç…§ä¸Šè¿°çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²6ä¸ªæœºå™¨æ¥åŒæ—¶å®Œæˆä»»åŠ¡ã€‚

è€Œä¸”ï¼Œå¯¹äºMapå’ŒReduceå‡½æ•°æ¥è¯´ï¼Œä¼˜ç‚¹æœ‰ä¸¤ä¸ªï¼š
1. é€»è¾‘ç®€å•ï¼Œä»…ä»…æ˜¯ç®€å•çš„è®¡ç®—é€»è¾‘ã€‚å› æ­¤è¿è¡Œé€Ÿåº¦å¿«
2. å¯ä»¥æ–¹ä¾¿çš„æ¨ªå‘æ‰©å±•ã€‚

æœ€å…³é”®çš„ç‚¹åœ¨äº
```
ç¨‹åºå‘˜åªéœ€å…³å¿ƒé€»è¾‘ï¼Œä¸ç”¨æ“å¿ƒåˆ†å¸ƒã€å®¹é”™ã€è°ƒåº¦ç­‰å¤æ‚ç»†èŠ‚
```

### æ•´ä½“æ‰§è¡Œæµç¨‹

[æ‰§è¡Œæµç¨‹å›¾ç‰‡]

1. è¾“å…¥æ•°æ®è¢«åˆ†ç‰‡ï¼ˆSplitï¼‰
- åŸå§‹çš„å¤§æ•°æ®ï¼ˆæ¯”å¦‚ 1TB çš„æ—¥å¿—ï¼‰è¢«åˆ‡åˆ†æˆå¤šä¸ªå°ç‰‡ï¼ˆé€šå¸¸ 64MB æˆ– 128MB ä¸€ç‰‡ï¼‰ã€‚
- æ¯ä¸ªæ•°æ®ç‰‡ï¼ˆsplitï¼‰ä¼šç”±ä¸€ä¸ª Map Task å¤„ç†ã€‚

ğŸ‘‰ æ¯”å–»ï¼šåƒæŠŠä¸€æœ¬åšä¹¦åˆ†æˆä¸€é¡µä¸€é¡µï¼Œç”±å¤šä¸ªè¯»è€…åŒæ—¶é˜…è¯»å¤„ç†ã€‚

2. Map é˜¶æ®µæ‰§è¡Œï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰

- ç³»ç»Ÿåœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ª Map Workerï¼Œæ¯ä¸ªè´Ÿè´£ä¸€ä¸ª splitã€‚
- æ¯ä¸ª Map Workerï¼š
    - è¯»å–æ•°æ®ç‰‡
    - æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„ Map() å‡½æ•°
    - è¾“å‡ºä¸€ç»„é”®å€¼å¯¹ (key, value)
    - æŠŠè¾“å‡ºç¼“å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸Šï¼Œå¹¶æ ¹æ® key åšåˆ†åŒºï¼ˆä¸ºæ¥ä¸‹æ¥çš„ Reduce åšå‡†å¤‡ï¼‰

ğŸ‘‰ æ¯”å–»ï¼šæ¯ä½å·¥äººå¤„ç†ä¸€æ‘åŸææ–™ï¼Œå¹¶å°†æˆæœæ”¾å…¥ä¸åŒé¢œè‰²çš„æ¡¶ï¼ˆæŒ‰ key åˆ†ç±»ï¼‰ã€‚

3. åˆ†åŒºä¸ Shuffleï¼ˆæ´—ç‰Œé˜¶æ®µï¼‰
- ç³»ç»Ÿè‡ªåŠ¨å°†æ‰€æœ‰ Map çš„è¾“å‡ºï¼ŒæŒ‰ `key` åˆ†å‘ç»™ä¸åŒçš„ `Reduce Worker`ã€‚
- è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º `shuffle`ï¼Œæ˜¯ `MapReduce` çš„æ ¸å¿ƒã€‚
- Reduce Worker ä»å„ä¸ª Map Worker å–è‡ªå·±è´Ÿè´£çš„é‚£ä¸€éƒ¨åˆ† keyã€‚

ğŸ‘‰ æ¯”å–»ï¼šæ¯ä¸ªæ¡¶è¢«é€åˆ°å¯¹åº”çš„æ”¶é›†å‘˜æ‰‹é‡Œï¼Œæ”¶é›†å‘˜åªå…³å¿ƒè‡ªå·±é‚£ç§é¢œè‰²çš„æ¡¶ã€‚

4. Reduce é˜¶æ®µæ‰§è¡Œ

æ¯ä¸ª Reduce Workerï¼š
- æ¥æ”¶æ‰€æœ‰å±äºè‡ªå·±è´Ÿè´£ key çš„ (key, [value list])
- æ‰§è¡Œ Reduce() å‡½æ•°ï¼Œè¾“å‡ºæœ€ç»ˆç»“æœ

ğŸ‘‰ æ¯”å–»ï¼šæ¯ä¸ªæ”¶é›†å‘˜æŠŠæ”¶åˆ°çš„åŒä¸€ç±»ç‰©å“åˆå¹¶ã€ç»Ÿè®¡æˆ–æ€»ç»“ã€‚

5. ç»“æœè¾“å‡º

- Reduce ç»“æœè¢«å†™å…¥åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ GFS æˆ– HDFSï¼‰
- æ¯ä¸ª Reduce Worker å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œå½¢æˆæœ€ç»ˆçš„è¾“å‡ºé›†åˆã€‚

 6. å®¹é”™æœºåˆ¶ï¼ˆFault Toleranceï¼‰

- MapReduce æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å®ƒå¯¹æœºå™¨æ•…éšœæœ‰å¼ºå¤§å®¹é”™æ”¯æŒï¼š
- ä»»åŠ¡å¤±è´¥äº†ï¼Ÿâ€”â€”Master ä¼šæŠŠä»»åŠ¡é‡æ–°åˆ†é…ç»™å¦ä¸€å°æœºå™¨ã€‚
- æœºå™¨å®•æœºï¼Ÿâ€”â€”ç³»ç»Ÿæ£€æµ‹å¿ƒè·³è¶…æ—¶ï¼ŒæŠŠä»»åŠ¡è½¬ç§»ã€‚

`Reduce` ä¸ä¼šä»å†…å­˜é‡Œè¯»æ•°æ®ï¼Œè€Œæ˜¯ä» `Map` çš„æœ¬åœ°ç£ç›˜æ‹‰ï¼Œè¿™æ ·æ›´å®‰å…¨ã€‚

ğŸ‘‰ æ¯”å–»ï¼šå¦‚æœä¸€ä¸ªå·¥äººç´¯äº†/èµ°äº†ï¼Œå¦ä¸€ä¸ªäººæ¥æ‰‹ç»§ç»­å¹²ï¼Œä¸å½±å“æ•´ä½“ç»“æœã€‚

### å®¹é”™æœºåˆ¶

è¿™æ˜¯ `MapReduce` çš„äº®ç‚¹ä¹‹ä¸€ï¼Œå®ƒè‡ªåŠ¨å¤„ç†å„ç§å¤±è´¥æƒ…å†µï¼š

ğŸ§¯ Map æˆ– Reduce ä»»åŠ¡å¤±è´¥
    - Worker å´©äº†ï¼Ÿä»»åŠ¡å¤±è´¥ï¼Ÿ
    - âœ… Master é‡æ–°è°ƒåº¦ä»»åŠ¡ï¼Œç”±å…¶ä»–ç©ºé—² Worker é‡åš

ğŸ’€ Worker èŠ‚ç‚¹å®•æœº
    - Master æ£€æµ‹ä¸åˆ°å¿ƒè·³ä¿¡å·ï¼ˆæ¯”å¦‚ 10 ç§’æ²¡å›åº”ï¼‰
    - âœ… æ‰€æœ‰è¯¥èŠ‚ç‚¹ä¸Šçš„ä»»åŠ¡éƒ½ä¼šè¢«è§†ä¸ºå¤±è´¥ï¼Œé‡æ–°è°ƒåº¦

ğŸ“‰ Reduce ä¸ä¼šå› ä¸º Map å´©äº†è€ŒæŒ‚æ‰
    - å› ä¸º Map çš„ä¸­é—´ç»“æœä¼šå†™å…¥ç£ç›˜ï¼Œä¸” Reduce æ˜¯æ‹‰æ•°æ®

| ä¼˜åŒ–ç‚¹                    | è¯´æ˜                                                            |
| ---------------------- | ------------------------------------------------------------- |
| **æ•°æ®æœ¬åœ°æ€§**              | å°½é‡å°† Map ä»»åŠ¡è°ƒåº¦åˆ°æ•°æ®æ‰€åœ¨çš„æœºå™¨ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“                                   |
| **å¤‡ä»½ä»»åŠ¡**ï¼ˆBackup Tasksï¼‰ | åœ¨ä»»åŠ¡å¿«ç»“æŸæ—¶ï¼Œä¸ºå‰©ä½™æœ€æ…¢çš„ä»»åŠ¡å¯åŠ¨å‰¯æœ¬ï¼Œé¿å…å°¾éƒ¨æ‹–æ…¢æ•´ä¸ªä»»åŠ¡ï¼ˆç§°ä¸ºâ€œ**straggler mitigation**â€ï¼‰ |
| **æµæ°´çº¿æ‰§è¡Œ**              | Reduce Worker å¯ä»¥åœ¨ Map æœªå®Œå…¨ç»“æŸæ—¶ï¼Œå¼€å§‹æ‹‰éƒ¨åˆ†æ•°æ®                          |

| ç‰¹æ€§                  | å¥½å¤„             |
| ------------------- | -------------- |
| ä¸»ä»æ¶æ„ï¼ˆMaster/Workerï¼‰ | æ˜“äºè°ƒåº¦å’Œç®¡ç†        |
| æœ¬åœ°ç£ç›˜ç¼“å­˜ä¸­é—´ç»“æœ          | æé«˜å®¹é”™æ€§å’Œæ•ˆç‡       |
| Shuffle è‡ªåŠ¨è¿›è¡Œ        | ç¨‹åºå‘˜æ— éœ€å¤„ç†ç½‘ç»œä¼ è¾“    |
| å®¹é”™æœºåˆ¶å®Œå¤‡              | ä»»æ„èŠ‚ç‚¹å¤±è´¥ä¸ä¼šå½±å“æ•´ä½“ä»»åŠ¡ |
| è‡ªåŠ¨è°ƒåº¦å’Œé‡è¯•             | è§£æ”¾ç¨‹åºå‘˜åŒæ‰‹        |

### æ€§èƒ½

ğŸ§ª æ¡ˆä¾‹1ï¼šæ„å»ºå€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰
ğŸŒŸ åº”ç”¨èƒŒæ™¯ï¼š
Google æœç´¢å¼•æ“éœ€è¦çŸ¥é“æ¯ä¸ªè¯åœ¨å“ªäº›ç½‘é¡µä¸­å‡ºç°ã€‚è¿™ä¸ªæ“ä½œå°±å«â€œæ„å»ºå€’æ’ç´¢å¼•â€ã€‚

ğŸ“¦ å¤„ç†è§„æ¨¡ï¼š
- è¾“å…¥æ•°æ®ï¼šçº¦ 20TBï¼ˆç½‘é¡µå†…å®¹ï¼‰
- Map ä»»åŠ¡æ•°ï¼š1ä¸‡ä¸ª
- Reduce ä»»åŠ¡æ•°ï¼š2åƒä¸ª

â± æ‰§è¡Œæ—¶é—´ï¼š
æ•´ä¸ªä»»åŠ¡åœ¨å‡ ç™¾å°æœºå™¨ä¸Šå¹¶è¡Œï¼ŒåªèŠ±äº†å‡ å°æ—¶

âœ… æ„ä¹‰ï¼š
ä¼ ç»Ÿæ–¹å¼å®ç°è¿™æ ·çš„ä»»åŠ¡è¦èŠ±å‡ å‘¨ç”šè‡³å‡ ä¸ªæœˆï¼Œè€Œ MapReduce èƒ½å¿«é€Ÿå®Œæˆï¼Œè¿˜èƒ½å¤„ç†èŠ‚ç‚¹æ•…éšœã€‚

ğŸ§ª æ¡ˆä¾‹2ï¼šåˆ†æç½‘é¡µè¿æ¥å›¾ï¼ˆPageRank è®¡ç®—ï¼‰
ğŸŒŸ åº”ç”¨èƒŒæ™¯ï¼š
PageRank æ˜¯ Google æœç´¢æ’åçš„æ ¸å¿ƒç®—æ³•ï¼Œéœ€è¦å¤„ç†æ•´ä¸ªäº’è”ç½‘çš„ç½‘é¡µé“¾æ¥å…³ç³»ã€‚

ğŸ“¦ å¤„ç†è§„æ¨¡ï¼š
- è¾“å…¥æ•°æ®ï¼šè¶…è¿‡ 1TB çš„é“¾æ¥å›¾
- è¿è¡Œå¤šä¸ª MapReduce è¿­ä»£ï¼ˆæ¯ä¸€è½®éƒ½è¯»å–+å†™å…¥ï¼‰

â± æ‰§è¡Œæ—¶é—´ï¼š
å•è½®è€—æ—¶åœ¨å‡ ååˆ†é’Ÿåˆ°å‡ å°æ—¶ä¹‹é—´ï¼Œå–å†³äºè¿­ä»£æ¬¡æ•°

âœ… æ„ä¹‰ï¼š
MapReduce é€‚åˆè¿™ç§éœ€è¦åå¤è¿è¡Œã€èšåˆä¸­é—´ç»“æœçš„å›¾ç®—æ³•ã€‚

#### å¯æ‰©å±•æ€§å®éªŒ

è®ºæ–‡è¿˜ä¸“é—¨åšäº† å®éªŒæµ‹è¯• MapReduce çš„å¯æ‰©å±•æ€§ï¼Œç»“æœéå¸¸äº®çœ¼ï¼š

å®éªŒè®¾ç½®ï¼š
- ä»»åŠ¡ï¼šæ’åº 1TB çš„æ•°æ®ï¼ˆæ ‡å‡†å¤§æ•°æ®è®¡ç®—ä»»åŠ¡ï¼‰
- æµ‹è¯•å˜é‡ï¼šæœºå™¨æ•°é‡ï¼ˆä»å‡ åå°åˆ°å‡ ç™¾å°ï¼‰

| æœºå™¨æ•°é‡  | æ‰§è¡Œæ—¶é—´    |
| ----- | ------- |
| 100 å° | \~60 åˆ†é’Ÿ |
| 200 å° | \~35 åˆ†é’Ÿ |
| 400 å° | \~20 åˆ†é’Ÿ |

âœ… è¯´æ˜ï¼šæœºå™¨æ•°é‡ç¿»å€ â†’ æ‰§è¡Œæ—¶é—´å‡ ä¹å‡åŠ
è¿™å«åšâ€œè¿‘çº¿æ€§æ‰©å±•æ€§â€ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ€§èƒ½çš„ç†æƒ³çŠ¶æ€ã€‚

#### å®¹é”™èƒ½åŠ›å®éªŒ

è®ºæ–‡è¿˜æµ‹è¯•äº†åœ¨æœ‰æœºå™¨æ•…éšœçš„æƒ…å†µä¸‹ç³»ç»Ÿèƒ½å¦ç¨³ä½ï¼š

å®éªŒæ–¹æ³•ï¼š
- åœ¨è¿è¡Œä¸­æ•…æ„æ€æ‰éƒ¨åˆ† Worker
- æŸ¥çœ‹ä»»åŠ¡æ˜¯å¦æ¢å¤ + æ—¶é—´æ˜¯å¦å¢åŠ å¾ˆå¤š

ç»“æœï¼š
- ç³»ç»Ÿèƒ½æˆåŠŸæ¢å¤å¤±è´¥ä»»åŠ¡
- æ•´ä½“æ‰§è¡Œæ—¶é—´ä»…ç•¥æœ‰å¢åŠ ï¼ˆå› ä¸ºå¤±è´¥é‡è¯•å¸¦æ¥å°å»¶è¿Ÿï¼‰

âœ… æ„ä¹‰ï¼šè¯´æ˜ MapReduce çš„å®¹é”™æœºåˆ¶åœ¨å®è·µä¸­å¯é ï¼Œä¸ä¼šå› ä¸ºå•ç‚¹å¤±è´¥æ‹–å®æ•´ä¸ªä»»åŠ¡ã€‚

#### ä¸€äº›ä¼˜åŒ–ç»†èŠ‚

| ä¼˜åŒ–ç­–ç•¥                 | æ•ˆæœ                      |
| -------------------- | ----------------------- |
| æœ¬åœ°æ€§è°ƒåº¦ï¼ˆData Localityï¼‰ | é¿å… Map ä»»åŠ¡è·¨æœºå™¨è¯»å–æ•°æ®ï¼Œå‡è½»ç½‘ç»œè´Ÿæ‹… |
| Map è¾“å‡ºå†™å…¥æœ¬åœ°ç£ç›˜         | é¿å… Reduce æ‹‰å–å¤±è´¥ï¼Œæé«˜ç¨³å®šæ€§    |
| Backup Taskï¼ˆå¤‡ä»½ä»»åŠ¡ï¼‰    | å‡å°‘ straggler å½±å“ï¼ŒåŠ å¿«å°¾éƒ¨æ‰§è¡Œ  |
| Reduce ç«¯éƒ¨åˆ†æ’åº         | é¿å… Reduce ç«¯å†…å­˜çˆ†ç‚¸ï¼Œæé«˜èšåˆæ•ˆç‡  |

#### å°ç»“ï¼šä¸ºä»€ä¹ˆ MapReduce æ€§èƒ½ä¼˜ç§€ï¼Ÿ

| æ–¹é¢     | ä¼˜åŠ¿               |
| ------ | ---------------- |
| å¹¶è¡Œè®¡ç®—   | æˆåƒä¸Šä¸‡å°æœºå™¨å¹¶å‘æ‰§è¡Œä»»åŠ¡    |
| ä»»åŠ¡åˆ†ç‰‡åˆç† | æ‹†æˆå¾ˆå¤šå°ä»»åŠ¡ï¼Œè°ƒåº¦çµæ´»     |
| è‡ªåŠ¨å®¹é”™   | èŠ‚ç‚¹å¤±è´¥ä¸ä¼šæ‹–å®ä»»åŠ¡       |
| IO ä¼˜åŒ–å¥½ | é¿å…ä¸å¿…è¦çš„ç½‘ç»œæµé‡       |
| æ‰©å±•æ€§å¼º   | æœºå™¨è¶Šå¤šï¼Œé€Ÿåº¦è¶Šå¿«ï¼Œæ•ˆç‡ä¸é™åå‡ |


### ç»éªŒ

1. ç¼–ç¨‹æ¨¡å‹ç®€å•ä½†è¡¨è¾¾åŠ›å¼º
ä½œè€…è§‚ç‚¹ï¼š
> MapReduce çš„æ¥å£éå¸¸ç®€å•ï¼ˆå°±ä¸¤ä¸ªå‡½æ•°ï¼šMap() å’Œ Reduce()ï¼‰ï¼Œä½†å‡ ä¹å¯ä»¥è¡¨è¾¾å¤§éƒ¨åˆ†å¹¶è¡Œæ•°æ®å¤„ç†é€»è¾‘ã€‚

å®é™…ä¾‹å­ï¼š
- æ’åºã€å»é‡ã€åˆå¹¶æ—¥å¿—
- æ„å»ºç´¢å¼•ã€è®¡ç®—ç½‘é¡µæƒé‡ã€å›¾å¤„ç†
- æ•°æ®æŒ–æ˜ä»»åŠ¡å¦‚èšç±»ã€ç»Ÿè®¡åˆ†æ

ğŸ§  ä½“ä¼šï¼š
ä½ ä¸éœ€è¦äº†è§£çº¿ç¨‹ã€é”ã€é€šä¿¡åè®®è¿™äº›â€œç¡¬æ ¸åˆ†å¸ƒå¼çŸ¥è¯†â€ï¼Œä¹Ÿèƒ½å†™å‡ºèƒ½åœ¨å‡ åƒå°æœºå™¨ä¸Šè·‘çš„å¤§æ•°æ®ç¨‹åºã€‚

2. å¯¹â€œå¤±è´¥â€é«˜åº¦å®¹å¿æ˜¯å¿…é¡»çš„
ä½œè€…è§‚ç‚¹ï¼š
> åœ¨å‡ ç™¾ä¸Šåƒå°æœºå™¨ä¸Šè¿è¡Œä»»åŠ¡ï¼Œæœºå™¨æ•…éšœæ˜¯å¸¸æ€ï¼Œä¸æ˜¯ä¾‹å¤–ã€‚ç³»ç»Ÿè®¾è®¡è¦â€œé»˜è®¤å®ƒä¼šå¤±è´¥â€ã€‚

åšæ³•ï¼š
- Map/Reduce Task è‡ªåŠ¨é‡è¯•
- Master è´Ÿè´£ç›‘æ§å’Œå†è°ƒåº¦
- ä¸­é—´ç»“æœå†™ç£ç›˜ã€æŒä¹…åŒ–ï¼Œæ–¹ä¾¿æ¢å¤

ğŸ§  ä½“ä¼šï¼š
ä¸è¦å»â€œé˜²æ­¢å¤±è´¥â€ï¼Œè¦â€œæ‹¥æŠ±å¤±è´¥â€ï¼Œè®©å¤±è´¥å˜å¾—å¯¹ç”¨æˆ·é€æ˜ï¼Œè¿™æ‰æ˜¯å·¥ä¸šçº§åˆ†å¸ƒå¼ç³»ç»Ÿã€‚

3. æ•°æ®æœ¬åœ°æ€§æ˜¯æ€§èƒ½å…³é”®
ä½œè€…è§‚ç‚¹ï¼š
> å°½é‡æŠŠè®¡ç®—è°ƒåº¦åˆ°æ•°æ®æ‰€åœ¨æœºå™¨ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘ç½‘ç»œå‹åŠ›ã€‚

åŸå› ï¼š
- åœ¨ Google æ–‡ä»¶ç³»ç»Ÿï¼ˆGFSï¼‰ä¸­ï¼Œæ•°æ®æœ‰å‰¯æœ¬
- Master å¯ä»¥æ ¹æ®å‰¯æœ¬ä½ç½®ï¼ŒæŠŠ Map ä»»åŠ¡è°ƒåˆ°æ•°æ®â€œèº«è¾¹â€

ğŸ§  ä½“ä¼šï¼š
åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œâ€œç§»åŠ¨è®¡ç®—â€æ¯”â€œç§»åŠ¨æ•°æ®â€æ›´é«˜æ•ˆ

4. Straggler é—®é¢˜æ˜¯çœŸå®å­˜åœ¨çš„
ä½œè€…è§‚ç‚¹ï¼š
> åœ¨æˆç™¾ä¸Šåƒä¸ªä»»åŠ¡ä¸­ï¼Œæ€»ä¼šæœ‰å‡ ä¸ªâ€œæ‰é˜Ÿè€…â€ï¼ˆstragglerï¼‰ï¼Œå®ƒä»¬å¯èƒ½å› ä¸ºç£ç›˜æ…¢ã€CPU æŠ¢å ç­‰åŸå› æ‹–æ…¢æ•´ä¸ªä½œä¸šã€‚

è§£å†³æ–¹æ¡ˆï¼š
- å¯åŠ¨ Backup Taskï¼ˆå¤‡ä»½ä»»åŠ¡ï¼‰
- å“ªä¸ªå…ˆå®Œæˆå°±ç”¨å“ªä¸ªï¼Œæ”¾å¼ƒå¦ä¸€ä¸ª

ğŸ§  ä½“ä¼šï¼š
åœ¨å¤§è§„æ¨¡å¹¶å‘ä¸­ï¼Œæ•´ä½“é€Ÿåº¦ç”±â€œæœ€æ…¢çš„å°‘æ•°äººâ€å†³å®šï¼ˆè¿™å°±æ˜¯â€œé•¿å°¾å»¶è¿Ÿâ€é—®é¢˜ï¼‰

5. å¼€å‘è°ƒè¯•å·¥å…·éå¸¸é‡è¦
ä½œè€…è§‚ç‚¹ï¼š
> è¿è¡Œæˆåƒä¸Šä¸‡ä¸ªä»»åŠ¡åï¼Œä½ å¾ˆéš¾é è‚‰çœ¼çœ‹æ—¥å¿—æ‰¾é—®é¢˜ï¼Œéœ€è¦ä¸“é—¨çš„ ç›‘æ§ä¸è°ƒè¯•å·¥å…·ã€‚

Google å®è·µï¼š
- ä¸ºæ¯ä¸ªä»»åŠ¡ç”Ÿæˆè¯¦ç»†çš„ web é¡µé¢
- å¯ä»¥è¿½è¸ªä»»åŠ¡çŠ¶æ€ã€å¤±è´¥åŸå› ã€æ•°æ®æµå‘
- æ‰€æœ‰ä»»åŠ¡çš„æ ‡å‡†è¾“å‡ºä¹Ÿä¼šè¢«æ”¶é›†å¹¶å­˜æ¡£

ğŸ§  ä½“ä¼šï¼š
å¥½çš„å·¥å…·ä¸ä»…èƒ½â€œçœ‹è§â€é—®é¢˜ï¼Œæ›´èƒ½â€œé¢„é˜²â€é—®é¢˜ã€‚

6. é€šç”¨æ€§å¼ºï¼Œæ”¯æŒè·¨éƒ¨é—¨å¤ç”¨
ä½œè€…è§‚ç‚¹ï¼š
> æœ€å¼€å§‹ MapReduce æ˜¯ä¸ºæ„å»ºç´¢å¼•è®¾è®¡çš„ï¼Œåæ¥è¢«åº”ç”¨äºï¼š

- æ—¥å¿—åˆ†æ
- æœºå™¨å­¦ä¹ æ•°æ®é¢„å¤„ç†
- å›¾ç»“æ„è®¡ç®—
- åˆ†å¸ƒå¼ Grepã€æ’åºã€å‹ç¼©
- å¤šè¯­è¨€æ”¯æŒï¼ˆC++ã€Javaã€Python ç­‰ï¼‰

ğŸ§  ä½“ä¼šï¼š
ä¸€ä¸ªç®€å•çš„æ€æƒ³ï¼Œé…ä¸Šè‰¯å¥½å°è£…ä¸å®¹é”™æœºåˆ¶ï¼Œå°±èƒ½æˆä¸ºå…¨å…¬å¸çš„â€œç”Ÿäº§åŠ›å·¥å…·â€

âœ… æœ€åï¼Œä½œè€…å¯¹è¯»è€…è¯´äº†ä»€ä¹ˆï¼Ÿ
ä»–ä»¬å¸Œæœ›å‘Šè¯‰å¤§å®¶ï¼š

> â€œMapReduce çš„æ ¸å¿ƒæ€æƒ³æ˜¯æŠ½è±¡ï¼šç¨‹åºå‘˜åªéœ€è¦å…³æ³¨å¦‚ä½•å†™ Map å’Œ Reduceï¼Œä¸éœ€è¦å»å¤„ç†åˆ†å¸ƒå¼çš„å¤æ‚æ€§ã€‚â€

è¿™ç§æ€æƒ³ä¸ä»…å½±å“äº†åæ¥çš„ Hadoop/Spark/Flinkï¼Œä¹Ÿå¯å‘äº†å¾ˆå¤š â€œè®©äººç±»ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œå…¶ä½™äº¤ç»™ç³»ç»Ÿâ€ çš„å·¥ç¨‹æ€ç»´ã€‚

æ€»ç»“ï¼š
| æ•™è®­/åæ€           | å«ä¹‰              |
| --------------- | --------------- |
| ç®€å•æ¥å£èƒœè¿‡å¤æ‚çµæ´»      | ç®€å•æ›´æ˜“å­¦æ›´æ™®åŠ        |
| å®¹é”™ä¸æ˜¯åŠ ä¸Šå»çš„ï¼Œæ˜¯è®¾è®¡è¿›æ¥çš„ | é¢å‘å¤±è´¥ç¼–ç¨‹          |
| è°ƒåº¦æ¯”ä½ æƒ³è±¡çš„é‡è¦       | æ•°æ®æœ¬åœ°æ€§å’Œé•¿å°¾é—®é¢˜ä¼šæ‹–å®ç³»ç»Ÿ |
| å·¥å…·è®©å¤§è§„æ¨¡ç³»ç»Ÿå¯ç»´æŠ¤     | åƒä¸‡åˆ«å¿½è§†ç›‘æ§ã€è°ƒè¯•ç•Œé¢    |
| é€šç”¨æ€§ä¸æ˜¯å‰¯äº§ç‰©ï¼Œæ˜¯ç›®æ ‡    | æŠ½è±¡è®¾è®¡æ—¶å°±è€ƒè™‘ä¸åŒåœºæ™¯    |

### å’Œå…¶ä»–çš„å¯¹æ¯”

ğŸ§­ MapReduce æå‡ºå‰ï¼Œä¸–ç•Œåœ¨å¹²ä»€ä¹ˆï¼Ÿ
åœ¨ MapReduce å‡ºç°ä¹‹å‰ï¼Œ**â€œå¤„ç†æµ·é‡æ•°æ®â€**æ˜¯éå¸¸ç—›è‹¦çš„äº‹æƒ…ï¼Œå¸¸å¸¸éœ€è¦ï¼š
- è‡ªå·±æ‰‹å†™åˆ†å¸ƒå¼ä»£ç ï¼ˆå¤šçº¿ç¨‹ã€RPCã€å®¹é”™é€»è¾‘ï¼‰
- æ‰‹åŠ¨åˆ†ç‰‡ã€è°ƒåº¦ã€å¤±è´¥é‡è¯•
- å¤§é‡ç³»ç»Ÿè°ƒä¼˜

ä¹Ÿå°±æ˜¯è¯´ï¼šé—¨æ§›é«˜ã€å‡ºé”™å¤šã€æ•ˆç‡ä½ã€‚

ğŸ§“ 1. å‰è¾ˆç³»ç»Ÿï¼ˆå…ˆé©±è€…ï¼‰
MapReduce å€Ÿé‰´å¹¶è¶…è¶Šäº†å¾ˆå¤šå·²æœ‰çš„ç³»ç»Ÿã€‚ä½œè€…æåˆ°äº†å‡ ä¸ªé‡è¦çš„å‰è¾ˆï¼š

ğŸ§± Parallel Databasesï¼ˆå¹¶è¡Œæ•°æ®åº“ç³»ç»Ÿï¼‰
æ¯”å¦‚ï¼šTeradata, Gamma, Volcano

- é€šè¿‡ SQL è‡ªåŠ¨å¹¶è¡Œæ‰§è¡Œã€æŸ¥è¯¢ä¼˜åŒ–

ä½†å±€é™æ€§æ˜æ˜¾ï¼š
- çµæ´»æ€§ä½ï¼Œåªé€‚åˆç»“æ„åŒ–æ•°æ®
- ç¼–ç¨‹æ¨¡å‹ä¸å¤Ÿé€šç”¨ï¼ˆä¸èƒ½è¡¨è¾¾å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼‰
- æ‰©å±•æ€§ä¸è¶³ï¼ˆéš¾ä»¥æ¨ªå‘æ‰©å±•åˆ°ä¸Šåƒå°æœºå™¨ï¼‰

MapReduce ä¸ä¹‹ä¸åŒï¼š

- ä¸éœ€è¦é¢„å®šä¹‰ schema
- å¯å¤„ç†ä»»æ„æ•°æ®ï¼ˆæ–‡æœ¬ã€å›¾åƒã€æ—¥å¿—ï¼‰
- æ‰©å±•æ€§å’Œå®¹é”™æœºåˆ¶æ˜¯æ ¸å¿ƒè®¾è®¡ç‚¹

ğŸ§‘â€ğŸ”§ Message Passing Systemsï¼ˆæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼‰
æ¯”å¦‚ MPIï¼ˆMessage Passing Interfaceï¼‰
- ç¨‹åºå‘˜æ‰‹åŠ¨æ§åˆ¶æ•°æ®ä¼ è¾“ã€ä»»åŠ¡è°ƒåº¦
- å¸¸ç”¨äºç§‘å­¦è®¡ç®—ã€æ¨¡æ‹Ÿç±»åº”ç”¨

ç¼ºç‚¹ï¼š
- ç¼–ç¨‹å¤æ‚ï¼ˆéœ€è¦æ‰‹åŠ¨å¤„ç†å¹¶å‘ã€åŒæ­¥ï¼‰
- å®¹é”™æ€§å·®ï¼ˆä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œå…¨ç›˜å¤±è´¥ï¼‰
- ä¸é€‚åˆåŠ¨æ€å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿ

MapReduce ä¼˜åŠ¿ï¼š
- è‡ªåŠ¨åˆ†å‘ä»»åŠ¡ä¸æ•°æ®
- è‡ªåŠ¨é‡è¯•å¤±è´¥ä»»åŠ¡
- å®¹é”™ã€è°ƒåº¦æœºåˆ¶éšè—åœ¨æ¡†æ¶é‡Œ

ğŸ§‘â€ğŸ« 2. ç¼–ç¨‹æ¨¡å‹çš„çµæ„Ÿæ¥æº
ğŸ“š Lispã€Functional Programming çš„ Map å’Œ Reduce
â€œMapâ€å’Œâ€œReduceâ€å…¶å®æ¥è‡ªå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ Lisp çš„æ ‡å‡†æ“ä½œï¼š
- map(f, list)ï¼šå¯¹åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ åº”ç”¨å‡½æ•° f
- reduce(f, list)ï¼šå°†åˆ—è¡¨èšåˆä¸ºä¸€ä¸ªå€¼ï¼ˆå¦‚æ±‚å’Œï¼‰

ä½œè€…æŠŠè¿™ä¸ªå°è€Œç¾çš„æ€æƒ³æ¨å¹¿åˆ°äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼š
- æŠŠä¸€ä¸ªâ€œå¤§åˆ—è¡¨â€åˆ‡æˆå‡ åƒå—ï¼Œæ¯å—å¹¶å‘ map
- æœ€åæ±‡æ€»ï¼ˆreduceï¼‰å„éƒ¨åˆ†ç»“æœ

åˆ›æ–°ç‚¹åœ¨äºï¼š

> ä¸æ˜¯å‡½æ•°åçš„æ–°ç“¶è£…æ—§é…’ï¼Œè€Œæ˜¯åŠ ä¸Šäº†è°ƒåº¦ã€åˆ†å¸ƒå¼è¿è¡Œã€å®¹é”™ã€æŒä¹…åŒ–ã€åˆ†åŒºç­‰â€œå·¥ç¨‹é­‚â€ã€‚
> æŠŠâ€œå‡½æ•°å¼æ€æƒ³â€å˜æˆäº†â€œå·¥ä¸šçº§å·¥å…·â€ã€‚

MapReduce æ˜¯åœ¨ Google å†…éƒ¨â€œå…¨å®¶æ¡¶å¼æ¶æ„â€ä¸­è¿è¡Œçš„ï¼Œä¾èµ–ä»¥ä¸‹åº•å±‚æ”¯æ’‘ï¼š

| ç³»ç»Ÿ                      | ä½œç”¨                |
| ----------------------- | ----------------- |
| GFSï¼ˆGoogle File Systemï¼‰ | å­˜å‚¨æµ·é‡æ•°æ®å—ï¼Œæ”¯æŒå‰¯æœ¬ã€é«˜å¯ç”¨  |
| Bigtable                | ç±»ä¼¼ NoSQL çš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨ |
| Scheduler + Monitoring  | æä¾›ä»»åŠ¡è°ƒåº¦ä¸å¥åº·ç›‘æ§èƒ½åŠ›     |

ä¸€äº›å…¶ä»–çš„ç³»ç»Ÿï¼š

| ç³»ç»Ÿ                   | ç®€ä»‹          | ç‰¹ç‚¹                          |
| -------------------- | ----------- | --------------------------- |
| **Hadoop MapReduce** | Apache å¼€æºå®ç° | æ¨¡ä»¿ Google MapReduceï¼Œæ”¯æŒ HDFS |
| **Dryadï¼ˆå¾®è½¯ï¼‰**        | æ›´çµæ´»çš„æ•°æ®æµå›¾æ¨¡å‹  | æ”¯æŒ DAGï¼Œä½†å¤æ‚åº¦ä¹Ÿæ›´é«˜              |
| **Spark**            | æ›´å¿«çš„å†…å­˜è®¡ç®—æ¨¡å‹   | é€‚åˆäº¤äº’å¼ã€å¤§è§„æ¨¡è¿­ä»£ä»»åŠ¡               |
| **Flink**            | å¼ºå®æ—¶æ•°æ®å¤„ç†     | æ”¯æŒæµ+æ‰¹ï¼Œè¯­ä¹‰æ›´å¼º                  |
| **Beam**             | é€šç”¨æ•°æ®å¤„ç† API  | å¯éƒ¨ç½²åˆ° Spark/Flink ç­‰ç³»ç»Ÿä¹‹ä¸Š      |

å¯¹æ¯”ï¼š

| è§’åº¦        | MapReduce ç›¸æ¯”å¦‚ä½•ï¼Ÿ    |
| --------- | ------------------ |
| ä¸å¹¶è¡Œæ•°æ®åº“ç›¸æ¯”  | æ›´çµæ´»ã€å¯æ‰©å±•ã€é¢å‘é€šç”¨è®¡ç®—     |
| ä¸æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿç›¸æ¯” | æ›´æ˜“ç”¨ã€å…·å¤‡è‡ªåŠ¨å®¹é”™         |
| ä¸å‡½æ•°å¼ç¼–ç¨‹ç›¸æ¯”  | åŠ å…¥å·¥ç¨‹å®ç°ï¼Œèƒ½åœ¨çœŸå®é›†ç¾¤è·‘     |
| ä¸åç»­ç³»ç»Ÿç›¸æ¯”   | æ˜¯â€œå¤§æ•°æ®ç³»ç»Ÿâ€çš„æ€æƒ³æºå¤´ï¼Œå½±å“æ·±è¿œ |

> MapReduce çš„è´¡çŒ®ä¸æ˜¯æå‡ºäº†ä»€ä¹ˆæ–°ç†è®ºï¼Œè€Œæ˜¯æŠŠâ€œåˆ†å¸ƒå¼è®¡ç®—â€è¿™ä»¶å¤æ‚çš„äº‹åšå¾—åƒâ€œå†™ä¸¤ä¸ªå‡½æ•°â€é‚£ä¹ˆç®€å•ï¼Œå¹¶çœŸæ­£è®©å®ƒåœ¨å‡ åƒå°æœºå™¨ä¸Šè·‘èµ·æ¥ã€‚

## ä¸ºä»€ä¹ˆè¿™é—¨è¯¾è¦ä½¿ç”¨GOè¯­è¨€

è¿™é—¨è¯¾ä¹‹å‰ä½¿ç”¨è¿‡C++è¿›è¡Œã€‚

ä½¿ç”¨GOçš„åŸå› å¦‚ä¸‹ï¼š
1. GOæœ‰ç°æˆçš„RPCåŒ…ï¼Œè€ŒC++æ²¡æœ‰ã€‚
2. GOæœ‰çº¿ç¨‹å’Œåƒåœ¾å›æ”¶çš„æ”¯æŒã€‚è€ŒC++éœ€è¦è‡ªå·±ç®¡ç†å†…å­˜è¿›è¡Œåƒåœ¾å›æ”¶ã€‚
    - å› æ­¤ï¼ŒGOæ›´åŠ å®‰å…¨ã€‚
    - GOæ›´åŠ ç®€å•ã€‚
    - GOæ›´ä¸å®¹æ˜“å‡ºé”™ã€‚
3. GOæ›´åŠ ç®€å•ï¼Œé”™è¯¯å¤„ç†ä¹Ÿæ›´åŠ å®¹æ˜“ï¼ŒC++çš„é”™è¯¯ä¿¡æ¯å¾ˆéš¾çœ‹å‡ºæ¥æ˜¯ä»€ä¹ˆé”™è¯¯ã€‚

è¿™é‡ŒæŒ‡çš„çº¿ç¨‹æ˜¯GOçš„åç¨‹ã€‚GO Routineã€‚

çº¿ç¨‹æ˜¯åˆ†å¸ƒå¼æœ€å¤§çš„éš¾é¢˜ã€‚

ä½¿ç”¨çº¿ç¨‹çš„åŸå› ï¼š
- IOå¹¶å‘ï¼šä¸åŒçš„ç¨‹åºå¯ä»¥å¤„äºä¸åŒçš„çŠ¶æ€ã€‚æ¯”å¦‚Açº¿ç¨‹åœ¨è¯»å–ç£ç›˜ä¿¡æ¯ï¼Œè€ŒBçº¿ç¨‹åœ¨æ‰§è¡Œè®¡ç®—ã€‚æ¯”å¦‚å¾ˆå¤šçº¿ç¨‹å‘é€äº†RPCè¯·æ±‚ï¼Œç­‰å¾…è¯·æ±‚å“åº”åè¿›è¡Œå¤„ç†ã€‚
- å¤šæ ¸å¹¶è¡Œæ€§ï¼šå½“é‡åˆ°å¤§é‡çš„è®¡ç®—ä»»åŠ¡æ—¶ï¼Œä½¿ç”¨å¤šçº¿ç¨‹åŒæ—¶è®¡ç®—ä¼šæ˜¾è‘—æé«˜æ•ˆç‡ã€‚ä¸¤ä¸ªçº¿ç¨‹ä¼šåŒæ—¶è¿è¡Œåœ¨ä¸åŒçš„CPUä¸Šé¢ã€‚
- ä¾¿æ·æ€§ï¼šå¯èƒ½ä½ å°±æ˜¯å¸Œæœ›åœ¨åå°æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæˆ–è€…å®šæ—¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚æ¯”å¦‚masterç”¨æ¥ç¡®è®¤å…¶ä»–çš„çº¿ç¨‹çš„å­˜æ´»çŠ¶æ€ï¼Œå®šæ—¶æ¯ç§’å‘é€ä¸€ä¸ªè¯·æ±‚è¿™æ ·ã€‚

äº‹ä»¶é©±åŠ¨ï¼šé™¤äº†ä½¿ç”¨çº¿ç¨‹ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¥å®ç°ã€‚
- ä¼˜ç‚¹ï¼šäº‹ä»¶é©±åŠ¨çš„å®ç°æ¯”çº¿ç¨‹æ›´åŠ é«˜æ•ˆï¼Œæ›´å¥½è°ƒè¯•ï¼Œå¯ä»¥ç”¨é¡ºåºçš„æ–¹å¼æ¥ç¼–ç¨‹ã€‚
- ç¼ºç‚¹ï¼šäº‹ä»¶é©±åŠ¨åªèƒ½å®ç°å¹¶å‘æ€§ï¼Œè€Œä¸èƒ½å®ç°å¤šæ ¸çš„å¹¶è¡Œæ€§ã€‚æ— æ³•å‘æŒ¥å¤šæ ¸æ€§èƒ½ã€‚
    - å½“ç„¶äº†ï¼Œå¯ä»¥é€šè¿‡åœ¨æ¯ä¸ªæ ¸å¿ƒä¸Šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å®ç°äº‹ä»¶é©±åŠ¨æ¥å‘æŒ¥å¤šæ ¸æ€§èƒ½ã€‚

çº¿ç¨‹å¼€å‘çš„æŒ‘æˆ˜ï¼š
1. å†…å­˜å…±äº«ï¼šå¤šä¸ªçº¿ç¨‹å…±äº«åŒæ ·çš„å†…å­˜æ•°æ®ï¼Œä¼šäº§ç”Ÿ`æ•°æ®ç«äº‰`ã€‚
    - è§£å†³åŠæ³•1ï¼šä½¿ç”¨é”ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´é”å¼€é”€ï¼Œè¿˜è¦è§£å†³å¯èƒ½å¾—æ­»é”é—®é¢˜ã€‚æœ‰äº›å†…éƒ¨çš„æ•°æ®ç»“æ„å¯èƒ½å¹¶ä¸éœ€è¦é”ï¼Œä½†æ˜¯ä½ ä¸å¾—ä¸æ”¯ä»˜é”çš„å¼€é”€ã€‚è¿™å¹¶ä¸æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚
    - è§£å†³åŠæ³•2ï¼šä½¿æ•°æ®ä¸å…±äº«ã€‚
2. åè°ƒï¼šå½“æˆ‘ä»¬ä½¿ç”¨é”çš„æ—¶å€™ï¼Œæ¶‰åŠçš„ä¸åŒçº¿ç¨‹å¯èƒ½ä¸çŸ¥é“å…¶ä»–çº¿ç¨‹çš„å­˜åœ¨ï¼Œä»–ä»¬åªæ˜¯æƒ³ä¸åœ¨`ä»»ä½•äººå¹²æ‰°`çš„æƒ…å†µä¸‹è·å–æ•°æ®ã€‚ä½†ä¹Ÿæœ‰æ—¶å€™ï¼Œä½ å¸Œæœ›çº¿ç¨‹çŸ¥é“å…¶ä»–çº¿ç¨‹çš„å­˜åœ¨ï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆåè¯»å–å®ƒçš„æ•°æ®ã€‚
    - å¯ä»¥ä½¿ç”¨Channelsæ¥é€šä¿¡
    - ä½¿ç”¨æ¡ä»¶å˜é‡æ¥é€šä¿¡
    - ä½¿ç”¨Wait Groupæ¥é€šä¿¡
3. æ­»é”ï¼šä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ã€‚

## GFS(è°·æ­Œæ–‡ä»¶ç³»ç»Ÿ)

ä¸»è¦æ˜¯`Big Storage`å¤§å‹åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›åº•å±‚çš„å­˜å‚¨åŠŸèƒ½ã€‚

å°†å­˜å‚¨çš„æ•°æ®æ”¾åˆ°å¤šä¸ªæœºå™¨ä¸Šé¢ã€‚

æœ‰è¶£çš„å¾ªç¯ï¼š
- æ€§èƒ½ï¼šå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæœºå™¨ä¸Šé¢ã€‚é€šå¸¸å«åš`åˆ†ç‰‡`ã€‚
- é”™è¯¯ï¼šå½“æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæœºå™¨ä¸Šé¢ï¼Œå…¶ä¸­ä¸€ä¸ªæœºå™¨å°±æœ‰å¯èƒ½å®•æœºï¼Œå› æ­¤éœ€è¦`å®¹é”™æ€§`
- å®¹é”™æ€§ï¼šå¯ä»¥é€šè¿‡å­˜å‚¨å¤šä¸ª`å‰¯æœ¬`æ¥è§£å†³å®¹é”™æ€§çš„é—®é¢˜ã€‚
- å‰¯æœ¬ï¼šå­˜å‚¨å¤šä¸ªå‰¯æœ¬åˆä¼šå¼•å…¥æ•°æ®`ä¸ä¸€è‡´`çš„é—®é¢˜ã€‚
- ä¸€è‡´æ€§ï¼šå¦‚æœéœ€è¦æ•°æ®å¼ºä¸€è‡´æ€§ã€‚åˆä¼šéœ€è¦ç‰ºç‰²æ€§èƒ½ã€‚

### å¼ºä¸€è‡´æ€§

æ¥ä¸€ä¸ªå°ç¤ºä¾‹ï¼š

å¯¹äºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨æ¥è¯´ï¼Œæ²¡æœ‰åˆ†å¸ƒå¼çš„åŠŸèƒ½ã€‚

è¿™ä¸ªæ—¶å€™ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘æ¥äº†è¯·æ±‚ã€‚
- C1 å†™å…¥xçš„å€¼ä¸º1
- C2 å†™å…¥xçš„å€¼ä¸º2

è¯·é—®ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡å™¨çš„xå€¼åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ
- ç­”æ¡ˆæ˜¯ä¸ç¡®å®šã€‚

ä½†æ˜¯å¯¹äºåé¢çš„æ‰€æœ‰è¯»è¯·æ±‚æ¥è¯´ï¼Œxçš„å€¼è¦ä¹ˆéƒ½æ˜¯1ï¼Œè¦ä¹ˆéƒ½æ˜¯2.

å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œåªè¦èƒ½è¾¾åˆ°è¿™ä¸ªæ•ˆæœå³å¯ã€‚

### å¤åˆ¶ç‰ˆæœ¬1ï¼ˆä¸å¥½çš„å¤åˆ¶è®¾è®¡ï¼‰

å¯¹äºæœ€ç®€å•çš„å¤åˆ¶æ¥è¯´ï¼Œå°±æ˜¯ç›´æ¥å¯åŠ¨ä¸¤ä¸ªæœåŠ¡å™¨ï¼ŒS1å’ŒS2ã€‚

å¯¹äºæ‰€æœ‰å®¢æˆ·ç«¯æ¥è¯´ï¼Œéƒ½åˆ†åˆ«è¯·æ±‚S1å’ŒS2è¿›è¡Œå†™å…¥ï¼Œä½†æ˜¯è¯»çš„æ—¶å€™åªè¯»S1.å½“S1å®•æœºä»¥åè¯»å–S2.

è¿™ä¸ªæ—¶å€™ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘æ¥äº†è¯·æ±‚ã€‚
- C1 è¯·æ±‚S1 å†™å…¥xçš„å€¼ä¸º1
- C2 è¯·æ±‚S2 å†™å…¥xçš„å€¼ä¸º2
- C1 è¯·æ±‚S2 å†™å…¥xçš„å€¼ä¸º1
- C2 è¯·æ±‚S1 å†™å…¥xçš„å€¼ä¸º2

![å®¢æˆ·ç«¯å†™å…¥](../images/6824/1-1.png)

é‚£ä¹ˆæœ€ç»ˆï¼ŒS1å­˜å‚¨xçš„å€¼ä¸º2.S2å­˜å‚¨xçš„å€¼ä¸º1.ä¹Ÿå°±äº§ç”Ÿäº†`æ•°æ®ä¸ä¸€è‡´`ã€‚æ‰€ä»¥è¿™æ˜¯ä¸ªæœ€ç®€å•ä½†ä¹Ÿä¸å¥½çš„å¤åˆ¶è®¾è®¡ã€‚

### GFSæ¶æ„

GFSå°†ä¸€ä¸ªæ–‡ä»¶åˆ†æˆå¤šä¸ª`å—`ï¼Œæ¯ä¸ªå—æ˜¯64MBå¤§å°ã€‚æ¯ä¸ªå—éƒ½å¯ä»¥å­˜åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šé¢ã€‚

æœ‰ä¸€ä¸ª`ä¸»æœåŠ¡å™¨`ï¼Œä¸»æœåŠ¡å™¨è´Ÿè´£åˆ†å‘è¯·æ±‚ï¼Œè®°å½•äº†`æ–‡ä»¶åç§°`å’Œ`æ–‡ä»¶å—`çš„æ˜ å°„ã€‚

è¿˜æœ‰å¤šä¸ª`å—æœåŠ¡å™¨`ã€‚å—æœåŠ¡å™¨å­˜å‚¨äº†å®é™…çš„å—æ•°æ®ã€‚

ä¸»æœåŠ¡å™¨å­˜å‚¨äº†ä»¥ä¸‹æ•°æ®ï¼š
- æ–‡ä»¶åç§°å’Œ`chunk handlesæ•°ç»„`çš„æ˜ å°„ã€‚ä¹Ÿå°±æ˜¯æ¯ä¸ªæ–‡ä»¶åˆ†æˆäº†å“ªäº›å—ã€‚è¿™ä¸ªæ•°æ®æ˜¯éœ€è¦æŒä¹…åŒ–çš„ã€‚
- chunk handleså’Œ`chunk serversæ•°ç»„`çš„æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå—å­˜åœ¨å“ªäº›å—æœåŠ¡å™¨ä¸Šã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªå—éƒ½æ˜¯æœ‰å‰¯æœ¬çš„ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªæœåŠ¡å™¨æ•°ç»„ã€‚å¹¶ä¸”å®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©æœ€è¿‘çš„æœåŠ¡å™¨è¿›è¡Œè·å–ã€‚
- æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œéœ€è¦æŒä¹…åŒ–ã€‚
- æ˜¯å¦æ˜¯ä¸»æœåŠ¡å™¨ã€‚
- ä»»æœŸç»“æŸæ—¶é—´ã€‚

#### GFSçš„æŒä¹…åŒ–

GFSä½¿ç”¨`Log`æ¥è®°å½•æŒä¹…åŒ–çš„ä¿¡æ¯ï¼Œå¹¶é€šè¿‡`check point`æ¥è¿›è¡Œè¾…åŠ©ã€‚æ¢å¤çš„æ—¶å€™åªéœ€è¦ä»`check point`æ¢å¤å°±å¯ä»¥äº†ã€‚

å…¶å®å¤§å¤šæ•°çš„å­˜å‚¨ç³»ç»Ÿéƒ½æ˜¯è¿™ä¹ˆå¹²çš„ã€‚

#### GFSè¯»å–è¿‡ç¨‹

è¯»å–è¿‡ç¨‹
- 

## æ–‡æœ«ç¦åˆ©

> å…³æ³¨æˆ‘å‘é€â€œMySQLçŸ¥è¯†å›¾è°±â€é¢†å–å®Œæ•´çš„MySQLå­¦ä¹ è·¯çº¿ã€‚
> å‘é€â€œç”µå­ä¹¦â€å³å¯é¢†å–ä»·å€¼ä¸Šåƒçš„ç”µå­ä¹¦èµ„æºã€‚
> å‘é€â€œå¤§å‚å†…æ¨â€å³å¯è·å–äº¬ä¸œã€ç¾å›¢ç­‰å¤§å‚å†…æ¨ä¿¡æ¯ï¼Œç¥ä½ è·å¾—é«˜è–ªèŒä½ã€‚
> å‘é€â€œAIâ€å³å¯é¢†å–AIå­¦ä¹ èµ„æ–™ã€‚
> éƒ¨åˆ†ç”µå­ä¹¦å¦‚å›¾æ‰€ç¤ºã€‚

![æ¦‚å¿µå­¦ä¹ ](https://thepatterraining.github.io/images/bottom1.png)

![æ¦‚å¿µå­¦ä¹ ](https://thepatterraining.github.io/images/bottom2.png)

![æ¦‚å¿µå­¦ä¹ ](https://thepatterraining.github.io/images/bottom3.png)

![æ¦‚å¿µå­¦ä¹ ](https://thepatterraining.github.io/images/bottom4.png)


