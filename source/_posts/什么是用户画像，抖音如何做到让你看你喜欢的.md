---
title: 什么是用户画像，抖音如何做到让你看你喜欢的
date: 2025-02-10 10:12:47
tags: ['算法']
category: 算法
article: 什么是用户画像，抖音如何做到让你看你喜欢的
---

> 大家好，我是大头，职高毕业，现在大厂资深开发，前上市公司架构师，管理过10人团队！
> 我将持续分享成体系的知识以及我自身的转码经验、面试经验、架构技术分享、AI技术分享等！
> 愿景是带领更多人完成破局、打破信息差！我自身知道走到现在是如何艰难，因此让以后的人少走弯路！
> 无论你是统本CS专业出身、专科出身、还是我和一样职高毕业等。都可以跟着我学习，一起成长！一起涨工资挣钱！
> 关注我一起挣大钱！文末有惊喜哦！

“凌晨1点，你躺在床上第103次对自己说‘再看最后一个视频就睡’。手指机械地上滑，屏幕突然跳出一只圆滚滚的橘猫——和你上周走丢的那只简直一模一样。你瞬间清醒，长按屏幕点了收藏，下一秒，系统又推来三个宠物视频：一只撒娇的布偶、一只拆家的二哈，甚至还有宠物殡葬的科普……

你后背一凉：抖音怎么比男朋友还懂我？！”

# 「用户画像」是什么？抖音如何用代码“算”出你的喜好？揭秘背后的技术逻辑！

## 代码正在“偷窥”你的生活

“上瘾”背后的数据陷阱：

你刷到的每一个“刚刚好”的视频——深夜放毒的美食、周末必推的露营攻略、甚至分手后突然涌现的伤感BGM——都不是偶然。

真实案例：
```
程序员小李的“社死现场”：
“上周开会摸鱼搜了‘痔疮药’，当晚抖音首页全是肛肠医院广告……同事围观我手机时，我恨不得当场卸载APP！”
```

用户行为显微镜：
```
你的每一次点击、停留、点赞、划走，甚至视频看到一半突然锁屏——这些动作在后台早已被拆解成无数个“0”和“1”，拼凑出连你自己都未曾察觉的“兴趣密码”。
```

## 程序员如何用代码“造”出一个你？

> “你以为你在刷视频？其实是抖音在用用户画像和推荐算法反向‘刷’你！”

- 行为追踪
    - 你滑动屏幕的0.5秒里，后台如何通过埋点代码实时捕获你的动作？（Hint：API接口暗中“贴”在你的手指上）
- 数据炼金术
    - 每天数亿用户产生PB级数据，系统怎样在毫秒间从海量内容中捞出“最对你胃口”的那条视频？（分布式架构：让十万台服务器替你“打工”）
- 算法攻心计
    - 为什么连你妈都不知道你爱吃螺蛳粉，抖音却能在三次滑动内精准推荐？（协同过滤算法：找到和你“臭味相投”的陌生人）

今天，我们从代码层面掀开抖音的“读心术”

接下来，你将看到：
- 你的‘数据分身’如何被埋点、清洗、打标签，最终成为算法眼中的‘透明人’；
- 推荐系统怎样用‘召回-排序-多样性控制’三连招，让你欲罢不能；
- 程序员为扛住全民刷抖音的流量，在后台默默承受的‘福报’（高并发场景下的极限操作）。

## 用户画像：你的“数据分身”是如何炼成的？

### 数据采集：代码像“狗仔队”一样追踪你

1. 埋点监听：

前端埋点：用户每次点击、滑动、点赞时，客户端自动触发埋点事件（如 onClick、onScroll），通过API将行为数据上报到服务器。

```javascript
// 伪代码示例：点赞事件埋点
video.likeButton.addEventListener('click', () => {
  trackEvent('video_like', {
    video_id: '123',
    user_id: '456',
    timestamp: Date.now()
  });
});
```

后端日志：服务器接收请求后，记录用户IP、设备ID、请求路径等原始日志，形成“用户行为流水账”。

2. 设备指纹：

- 通过 User-Agent 获取手机型号、操作系统；
- 利用GPS、Wi-Fi SSID/IP定位常驻区域（比如“北京海淀区中关村打工人”）；
- 甚至通过陀螺仪数据判断用户是躺着刷还是坐着刷（影响推荐时段策略）。

热知识：

> 为什么你切换到4G网络，推荐内容突然变“土味”？
> ——因为系统发现你从一线城市CBD的WiFi切换到老家县城的基站IP，立刻调高“下沉市场”内容权重！

### 数据清洗与存储：把“生肉”加工成“熟数据”

技术流程：

1. 实时流处理（如Kafka + Flink）：

- 用户滑动屏幕后，行为数据在 5毫秒内 进入Kafka消息队列；
- Flink实时过滤无效数据（比如误触导致的0.1秒停留）。

2. 离线分析（如Hadoop + Hive）：

- 每天凌晨启动MapReduce任务，统计用户长期行为（例如“过去30天每晚8点必看游戏直播”）。

3. 存储优化：

- 列式存储（HBase）：将用户标签按列存储，快速查询“所有喜欢猫的用户”；
- Redis缓存：高频标签（如“近期热搜词”）常驻内存，应对瞬时高并发请求。

### 标签体系：给你的兴趣“贴满小纸条”

标签类型与算法逻辑：

1. 基础标签（直接提取）：

- 性别：通过头像、昵称、搜索词NLP分析（比如昵称含“喵”大概率女性）；
- 消费能力：根据手机型号（iPhone 15 Pro Max vs 千元机）、是否开通抖音会员。

2. 兴趣标签（行为分析）：

- 短期兴趣：基于实时行为（例如连续刷10条滑雪视频，立刻打上“滑雪”标签）；
- 长期兴趣：通过TF-IDF算法从历史行为中提取关键词（比如“编程”“显卡评测”）。

3. 动态标签（实时调整）：

- 衰减机制：上周的“螺蛳粉”标签权重每天下降10%，防止过期兴趣干扰；
- 突发兴趣：若用户突然搜索“三亚旅游”，权重瞬间提升至0.8，触发紧急推荐。

热知识
> 为什么你只是看了一眼美女视频，系统却疯狂推荐？
> ——因为算法发现该视频的“完播率”达95%，且你的“停留时长比均值高3秒”，立刻判定为潜在兴趣！

### 技术难点：如何让“数据分身”逼近真实的你？

- 去重与纠错：
    - 用布隆过滤器（Bloom Filter）排除重复点击（比如误触同一视频3次）；
    - 通过行为序列分析识别“借用手机场景”（例如家长手机突然出现小学生爱看的动画片）。
- 冷启动问题：
    - 新用户首次打开抖音时，推荐“地域热门+设备均价内容”（比如深圳用户默认推科技测评，县城用户推本地新闻）。
- 存储成本优化：
    - 对低频标签（如“用户5年前点赞过的冷门歌曲”）使用廉价对象存储（如AWS S3），高频标签用SSD硬盘扛压力。

## 推荐算法：如何让代码“猜”中你的心思？

### 召回层：从“大海捞针”到“精准撒网”

技术目标：从亿级视频池中快速筛选出 千分之一 的候选内容。

核心策略：

1. 协同过滤（CF）：
- User-Based：找到和你行为相似的用户，推荐他们喜欢的视频。

```PYTHON
# 伪代码：计算用户相似度（余弦相似度）  
def user_similarity(user1, user2):  
    common_videos = user1.likes & user2.likes  
    dot_product = sum(user1.likes[v] * user2.likes[v] for v in common_videos)  
    norm_user1 = sqrt(sum(val**2 for val in user1.likes.values()))  
    norm_user2 = sqrt(sum(val**2 for val in user2.likes.values()))  
    return dot_product / (norm_user1 * norm_user2)  
```

- Item-Based：推荐与你喜欢过的视频相似的内容（例如：看完《流浪地球》后推《三体》解说）。

2. 内容召回：

- 用NLP提取视频标题/字幕关键词（如“露营”“新手教程”），匹配用户兴趣标签。
- 图像识别分析视频封面（比如宠物视频中的猫狗品种）。

3. 热门兜底：

- 新用户首次打开APP时，直接推荐当日全站Top 100视频（避免“冷启动”尴尬）。

冷知识
> 为什么你的“小众爱好”突然被推荐？
> ——因为协同过滤发现某个和你有 97%相似度 的用户，昨晚点赞了这条视频，系统立刻“抄作业”推给你！

### 排序层：给视频“贴分数”，争夺你的注意力

技术目标：对召回层的千条候选视频，预测你对每条内容的 点击率（CTR） 和 完播率，精准排序。

模型架构：

1. 特征工程：

- 用户特征：标签权重、近期行为序列（如“最近3次点击均与露营相关”）。
- 内容特征：视频时长、关键词、作者粉丝量、实时点赞增速。
- 环境特征：当前时段（深夜推助眠视频）、网络类型（WiFi下推高清长视频）。

2. 深度学习模型：

- DNN（深度神经网络）：将特征向量输入多层网络，输出点击概率。
- 多任务学习：同时预测点击率、点赞率、评论率，综合计算“吸引力总分”。
- 实时更新：模型每隔15分钟增量训练，吸收最新用户反馈数据。

```python
# 伪代码：排序模型预测（简化版）  
def predict_ctr(user_features, video_features):  
    # 拼接用户特征和内容特征  
    input_vector = concat(user_features, video_features)  
    # 深度神经网络推理  
    ctr = dnn_model.predict(input_vector)  
    # 加入多样性惩罚（避免同类视频扎堆）  
    ctr *= diversity_penalty  
    return ctr  
```

热知识
> 为什么你刚买的手机，抖音立马推测评视频？
> ——因为排序模型发现“设备型号”与“开箱测评”类视频的 特征交叉权重 突然飙升，判定你处于“购物决策期”！

### 多样性控制：打破“信息茧房”的代码心机

技术目标：防止推荐内容过于单一（例如全是美女视频），引发用户厌倦。

核心策略：

1. 类别打散：

- 每刷10条视频，强制插入1条非兴趣标签内容（如教育、新闻）。
- 使用 `MAB（多臂老虎机算法）` 试探用户对新类型的反应。

2. 时间衰减：

- 连续推荐同一标签视频后，逐渐降低该标签权重（例如“露营”连推5次后权重减半）。

3. 突发热点：

- 监测全网爆款视频（如“某明星官宣”），强行插入到推荐流中，无论用户是否感兴趣。

热知识
> 为什么你总能看到老板的“正能量鸡汤视频”？
> ——因为系统默认所有用户对“平台热门内容”有 最低曝光阈值，哪怕你点了100次“不感兴趣”！

### 实时反馈：你的每一次滑动，都是算法的“调参器”

技术链条：

1. 动作捕获：

- 划走（负反馈）：触发降权（降低相似内容权重）；
- 完播 + 点赞（正反馈）：权重飙升，类似内容立即进入下一轮推荐。

2. 流式更新：

- 用户行为数据通过 Kafka 实时流入Flink，5秒内更新用户画像。
- 排序模型根据实时特征调整下一次推荐结果（比如你刚点赞“滑雪”，下一条立刻推滑雪装备广告）。

3. 后端架构挑战：

- 毫秒级响应：从用户滑动到推荐更新，全程不超过100ms（需分布式计算 + 缓存优化）。
- 数据一致性：确保画像更新与推荐结果同步（使用分布式锁或事务消息）。

## 后端工程师的挑战：高并发下的毫秒级博弈

### 实时性：你的“滑动”有多快，代码就得跑多快

技术场景：

用户每次滑动屏幕，系统需在 100ms内 完成：

1. 捕获行为 → 2. 更新画像 → 3. 召回排序 → 4. 返回推荐结果

核心方案：
- 流式计算（Apache Flink）：
    - 行为数据实时进入Flink流水线，通过状态（State）管理快速更新用户标签权重。

```java
// 伪代码：Flink实时处理用户滑动事件  
DataStream<UserAction> actions = env.addSource(kafkaSource);  
actions  
  .keyBy(userId)  
  .process(new UpdateProfileFunction()) // 实时更新画像  
  .addSink(recommendSink); // 触发推荐计算  
```

- 分布式存储：
    - 用户画像分片存储（如按UserID哈希分片到不同Redis集群），避免单点瓶颈。

### 高并发：每秒百万级请求下的“极限求生”

技术场景：

晚高峰时段，抖音推荐系统每秒处理 `数百万次`请求，相当于春运期间所有火车站同时检票。

架构设计：

1. 水平扩展：

- 无状态服务：推荐API服务实例可动态扩容（Kubernetes自动伸缩）；
- 分片负载均衡：用户请求按地域/设备类型路由到最近机房。

2. 缓存风暴防御：

- 多级缓存：
    - 本地缓存（Guava Cache）→ Redis集群 → 数据库。
- 缓存击穿方案：
    - 使用分布式锁（如Redisson）防止单个热点Key失效导致数据库雪崩。

```java
// 伪代码：缓存击穿防护  
RLock lock = redisson.getLock("VIDEO:123");  
if (lock.tryLock()) {  
    try {  
        data = db.getVideo(123);  
        redis.set("VIDEO:123", data, 60);  
    } finally {  
        lock.unlock();  
    }  
}  
```

3. 降级熔断：

- 若召回服务超时，自动降级为“热门视频兜底”；
- 使用Hystrix或Sentinel监控服务熔断状态。

热知识：
> 为什么明星官宣时抖音不崩？
> ——后台早已启动“ 大V预案 ”：提前预热缓存、限流非核心接口（比如评论加载），把资源留给推荐系统。

### 数据隐私：在“精准推荐”与“窥私骂名”间走钢丝

技术挑战：

既要利用`用户数据`优化推荐，又要避免`法律风险`（如GDPR、中国个人信息保护法）。

解决方案：

1. 匿名化处理：

- 用户标签与真实身份脱钩，使用哈希加密的UUID替代UserID。

2. 差分隐私：

- 在数据统计时注入噪声（如拉普拉斯噪声），防止通过数据反推个人身份。

```python
# 伪代码：拉普拉斯噪声注入  
def laplace_noise(data, epsilon):  
    scale = 1.0 / epsilon  
    noise = np.random.laplace(0, scale)  
    return data + noise  
```

3. 权限隔离：

- 开发/运维人员访问生产数据需动态申请权限，操作日志全程审计。

热知识：
> 为什么你从未搜索“植发”，却总看到生发广告？
> ——因为系统通过“协同过滤”发现，和你同年龄、同地域的男性用户都在点击这类广告！

### 容灾与一致性：当机房爆炸时，代码如何“自救”？

极端场景应对：

1. 多活架构：

- 用户流量分流到北京、上海、深圳三地机房，数据库通过Paxos/Raft协议同步数据。

2. 故障转移：

- 若某机房网络中断，5秒内切换DNS解析至备用机房（你只会感觉视频加载稍卡一下）。

3. 最终一致性：

- 允许短暂画像延迟（如你刚点赞的视频下一刷才生效），用消息队列保证数据最终一致。


## 总结

从`上头`到`解密`：
你以为你在抖音刷视频，实则是无数行代码在“刷”你。

每一次滑动、点赞、停留，都在为你的“数字分身”添砖加瓦。

用户画像像一位24小时不打烊的侦探，通过埋点、流式计算、标签体系，将你的兴趣拆解得明明白白；推荐算法则化身精准的注意力猎手，用协同过滤、深度学习、实时反馈，操控你的每一次心跳加速。

## 文末福利

> 关注我发送“MySQL知识图谱”领取完整的MySQL学习路线。
> 发送“电子书”即可领取价值上千的电子书资源。
> 发送“大厂内推”即可获取京东、美团等大厂内推信息，祝你获得高薪职位。
> 发送“AI”即可领取AI学习资料。
> 部分电子书如图所示。

![概念学习](https://thepatterraining.github.io/images/bottom1.png)

![概念学习](https://thepatterraining.github.io/images/bottom2.png)

![概念学习](https://thepatterraining.github.io/images/bottom3.png)

![概念学习](https://thepatterraining.github.io/images/bottom4.png)

