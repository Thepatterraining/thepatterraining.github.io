<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="YwTcBpc08sCpJAE8mKZglCGHjZc1BiK9UUagC8ldlaA">
  <meta name="msvalidate.01" content="true">
  <meta name="yandex-verification" content="true">
  <meta name="baidu-site-verification" content="3PbJKzlOf0">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"thepatterraining.github.io","root":"/","scheme":"Mist","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="dream">
<meta property="og:url" content="https://thepatterraining.github.io/page/8/index.html">
<meta property="og:site_name" content="dream">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Thepatter">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://thepatterraining.github.io/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>dream</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="dream" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">dream</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一个菜鸟程序员的成长历程</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/ES-%E5%A4%9A%E5%AD%97%E6%AE%B5bool%E6%9F%A5%E8%AF%A2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ES-%E5%A4%9A%E5%AD%97%E6%AE%B5bool%E6%9F%A5%E8%AF%A2.html" class="post-title-link" itemprop="url">ElasticSearch十七--ES-bool查询</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-21 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-21T00:00:00+08:00">2021-10-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/" itemprop="url" rel="index"><span itemprop="name">ES</span></a>
                </span>
            </span>

          
            <span id="/ES-%E5%A4%9A%E5%AD%97%E6%AE%B5bool%E6%9F%A5%E8%AF%A2.html" class="post-meta-item leancloud_visitors" data-flag-title="ElasticSearch十七--ES-bool查询" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/ES-%E5%A4%9A%E5%AD%97%E6%AE%B5bool%E6%9F%A5%E8%AF%A2.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/ES-%E5%A4%9A%E5%AD%97%E6%AE%B5bool%E6%9F%A5%E8%AF%A2.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="bool查询"><a href="#bool查询" class="headerlink" title="bool查询"></a>bool查询</h1><p>一个bool查询里面可以包含多个查询子句</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">must</td>
<td align="left">必须匹配，贡献算分</td>
</tr>
<tr>
<td align="left">should</td>
<td align="left">选择性匹配，算分</td>
</tr>
<tr>
<td align="left">must_not</td>
<td align="left">filter context 查询子句，必须不能匹配，不算分</td>
</tr>
<tr>
<td align="left">filter</td>
<td align="left">filter context 必须匹配,但是不算分</td>
</tr>
</tbody></table>
<ul>
<li>子查询可以任意顺序出现</li>
<li>可以嵌套多个查询</li>
<li>如果bool查询中，没有must条件，should中必须满足一个查询</li>
<li>should是一个数组</li>
</ul>
<p>查询语句的结构，会对相关度算分产生影响</p>
<ul>
<li>同一层级下的竞争字段，具有相同的权重</li>
<li>通过嵌套bool查询，可以改变对算分的影响</li>
</ul>
<h2 id="单字符串-多字段查询"><a href="#单字符串-多字段查询" class="headerlink" title="单字符串 多字段查询"></a>单字符串 多字段查询</h2><p>可以通过 <code>bool</code> 的 <code>should</code> 来实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST test_home/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;bool&quot;:&#123;</span><br><span class="line">      &quot;should&quot;:[</span><br><span class="line">        &#123;&quot;match&quot;:&#123;&quot;title&quot;:&quot;php&quot;&#125;&#125;</span><br><span class="line">        &#123;&quot;match&quot;:&#123;&quot;body&quot;:&quot;php&quot;&#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这样实现的算分过程可能不是我们想要的,算分过程如下</p>
<ul>
<li>查询 should 语句中的两个查询</li>
<li>加和两个查询的评分</li>
<li>乘以匹配语句的总数</li>
<li>除以所有语句的总数</li>
</ul>
<p>我们还可以使用最高算分 <code>dis_max</code>- <code>queries</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST test_home/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;dis_max&quot;:&#123;</span><br><span class="line">      &quot;queries&quot;:[</span><br><span class="line">        &#123;&quot;match&quot;:&#123;&quot;title&quot;:&quot;php&quot;&#125;&#125;</span><br><span class="line">        &#123;&quot;match&quot;:&#123;&quot;body&quot;:&quot;php&quot;&#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是有的时候，最高评分是一样的，那怎么办呢，可以通过<code>tie_breaker</code>参数来调整</p>
<ul>
<li>获得最佳匹配语句的评分</li>
<li>将其他匹配语句的评分与 <code>tie_breaker</code>相乘</li>
<li>对以上评分求和并规范化</li>
<li>tie_breaker 是一个 0 - 1的浮点数，0代表最佳匹配，1代表所有语句同等重要。</li>
</ul>
<h3 id="三种场景"><a href="#三种场景" class="headerlink" title="三种场景"></a>三种场景</h3><ul>
<li>最佳字段 best_fields 相当于 dis_max 查询<ul>
<li>当字段之间相互竞争，又相互关联。例如 title 和 body 这样的，评分来自最佳字段</li>
</ul>
</li>
<li>多数字段 most_fields<ul>
<li>处理英文内容时：一种常见的手段是，在主字段，抽取词干，加入同义词，以匹配更多的文档。相同的文本，加入子字段，以提供更加精确的匹配。其他字段作为匹配文档提高相关度的信号。匹配字段越多则越好</li>
</ul>
</li>
<li>混合字段 cross field<ul>
<li>对于某些实体，例如人名，地址，图书，需要在多个字段中确定信息，单个字段只能作为整体的一部分。希望在任何这些列出的字段中找到尽可能多的词</li>
</ul>
</li>
</ul>
<h4 id="multi-match"><a href="#multi-match" class="headerlink" title="multi_match"></a>multi_match</h4><blockquote>
<p>极客时间 ES 学习笔记</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/ES-%E6%90%9C%E7%B4%A2%E7%9B%B8%E5%85%B3%E6%80%A7%E7%AE%97%E5%88%86.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ES-%E6%90%9C%E7%B4%A2%E7%9B%B8%E5%85%B3%E6%80%A7%E7%AE%97%E5%88%86.html" class="post-title-link" itemprop="url">ElasticSearch十六--ES-搜索相关性算分</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-21 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-21T00:00:00+08:00">2021-10-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/" itemprop="url" rel="index"><span itemprop="name">ES</span></a>
                </span>
            </span>

          
            <span id="/ES-%E6%90%9C%E7%B4%A2%E7%9B%B8%E5%85%B3%E6%80%A7%E7%AE%97%E5%88%86.html" class="post-meta-item leancloud_visitors" data-flag-title="ElasticSearch十六--ES-搜索相关性算分" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/ES-%E6%90%9C%E7%B4%A2%E7%9B%B8%E5%85%B3%E6%80%A7%E7%AE%97%E5%88%86.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/ES-%E6%90%9C%E7%B4%A2%E7%9B%B8%E5%85%B3%E6%80%A7%E7%AE%97%E5%88%86.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="搜索相关性算分"><a href="#搜索相关性算分" class="headerlink" title="搜索相关性算分"></a>搜索相关性算分</h1><p>ES 会对搜索结果的相关性进行一个算分，算分结果放到<code>_score</code> 字段中。</p>
<p>算分是为了排序，ES5之前使用<code>TF-IDF</code>算法进行算分，之后使用<code>BM25</code>算法</p>
<h2 id="词频-TF"><a href="#词频-TF" class="headerlink" title="词频 (TF)"></a>词频 (TF)</h2><ul>
<li><p>term frequency: 检索词在一篇文档中出现的频率</p>
<ul>
<li>检索词出现的次数除以文档的总字数</li>
</ul>
</li>
<li><p>相关性：简单将搜索中每一个词的TF进行想加</p>
<ul>
<li>TF(区块链) + TF(的) + TF(作用)</li>
</ul>
</li>
<li><p>stop word： 没什么作用的词</p>
<ul>
<li><code>的</code> 可能会出现多次，但是他对于相关性并没有什么作用，应该不考虑他的词频， 可以作为一个 stop word</li>
</ul>
</li>
</ul>
<h2 id="逆文档频率-IDF"><a href="#逆文档频率-IDF" class="headerlink" title="逆文档频率 (IDF)"></a>逆文档频率 (IDF)</h2><ul>
<li><p>DF:检索词在所有文档中出现的频率</p>
<ul>
<li>区块链 在相对较少的文档中出现</li>
<li>作用 在相对较多的文档</li>
<li>的 作为 stop word 在大量的文档中出现</li>
</ul>
</li>
<li><p>inverse document frequency: 简单说 &#x3D; log(存储的全部文档数&#x2F;检索词出现过的文档数)</p>
</li>
<li><p>TF-IDF 就是将 TF 求和变成了加权求和</p>
</li>
</ul>
<p>比如，你ES里总共存储了10万条<code>职位信息</code>, 你检索 <code>php</code>，出现 php 的职位数量是1万，那么IDF &#x3D; log(10万&#x2F;1万) &#x3D; log(10) &#x3D; 1</p>
<ul>
<li>TF-IDF 就是算出分词后所有词的TF和 IDF 并进行处理，比如<code>区块链的作用</code> &#x3D; TF(区块链) * IDF(区块链) + TF(的) * IDF(的) + TF(作用) * IDF(作用)</li>
</ul>
<h2 id="BM25"><a href="#BM25" class="headerlink" title="BM25"></a>BM25</h2><p>BM25对之前的TF-IDF 算法进行了一个优化，当TF的词出现的越来越多的时候，如果是TF-IDF 算法，那么分值会增加很多，而如果是 BM25 算法，则会趋于一个极限。</p>
<h3 id="boosting"><a href="#boosting" class="headerlink" title="boosting"></a>boosting</h3><p><code>boosting</code>可以对算分结果进行影响</p>
<p>正常搜索<code>php首席</code>的结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PHP首席架构师</span><br><span class="line">PHP架构师</span><br><span class="line">PHP架构师001</span><br><span class="line">首席软件架构师</span><br><span class="line">首席软件架构师</span><br><span class="line">首席科学家（科研副总经理）</span><br><span class="line">首席科学家（工业传动技术）</span><br><span class="line">商家端资深软件开发工程师（Go/PHP）</span><br></pre></td></tr></table></figure>

<p>如果我们想降低<code>首席</code>这个词在搜索结果中的算分占比，可以使用<code>boosting</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET job_ik/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;boosting&quot;: &#123;  //boosting 关键字</span><br><span class="line">      &quot;positive&quot;: &#123;  //positive 关键字</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">          &quot;job_name&quot;: &quot;php&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;negative&quot;: &#123;  //negative 关键字</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">          &quot;job_name&quot;: &quot;首席&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;negative_boost&quot;: 0.2   // 0 - 1，降低首席排序，1-100，提高首席排序</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>降低后的结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PHP架构师</span><br><span class="line">PHP架构师001</span><br><span class="line">商家端资深软件开发工程师（Go/PHP）</span><br><span class="line">PHP首席架构师</span><br></pre></td></tr></table></figure>

<p>如果把<code>negative_boost</code>提升为2，那么结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PHP首席架构师</span><br><span class="line">PHP架构师</span><br><span class="line">PHP架构师001</span><br><span class="line">商家端资深软件开发工程师（Go/PHP）</span><br></pre></td></tr></table></figure>


<blockquote>
<p>极客时间 ES 学习笔记</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/ES-%E5%9F%BA%E4%BA%8E%E8%AF%8D%E9%A1%B9%E5%92%8C%E5%9F%BA%E4%BA%8E%E5%85%A8%E6%96%87%E7%9A%84%E6%9F%A5%E8%AF%A2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ES-%E5%9F%BA%E4%BA%8E%E8%AF%8D%E9%A1%B9%E5%92%8C%E5%9F%BA%E4%BA%8E%E5%85%A8%E6%96%87%E7%9A%84%E6%9F%A5%E8%AF%A2.html" class="post-title-link" itemprop="url">ElasticSearch十五--ES-基于词项和基于全文的查询</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-20T00:00:00+08:00">2021-10-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/" itemprop="url" rel="index"><span itemprop="name">ES</span></a>
                </span>
            </span>

          
            <span id="/ES-%E5%9F%BA%E4%BA%8E%E8%AF%8D%E9%A1%B9%E5%92%8C%E5%9F%BA%E4%BA%8E%E5%85%A8%E6%96%87%E7%9A%84%E6%9F%A5%E8%AF%A2.html" class="post-meta-item leancloud_visitors" data-flag-title="ElasticSearch十五--ES-基于词项和基于全文的查询" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/ES-%E5%9F%BA%E4%BA%8E%E8%AF%8D%E9%A1%B9%E5%92%8C%E5%9F%BA%E4%BA%8E%E5%85%A8%E6%96%87%E7%9A%84%E6%9F%A5%E8%AF%A2.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/ES-%E5%9F%BA%E4%BA%8E%E8%AF%8D%E9%A1%B9%E5%92%8C%E5%9F%BA%E4%BA%8E%E5%85%A8%E6%96%87%E7%9A%84%E6%9F%A5%E8%AF%A2.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="term-query"><a href="#term-query" class="headerlink" title="term query"></a>term query</h1><p><code>term</code>是表达语义的最小单位 ,搜索和利用统计语言模型进行自然语言处理都需要处理 term</p>
<p>特点</p>
<ul>
<li>term level query: term query&#x2F;range query&#x2F; exists query &#x2F; prefix query &#x2F; wildcard query</li>
<li>在ES里面，term 查询不做分词，把term查询作为一个整体词汇进行查询，进行一个精确匹配，并对匹配结果进行算分</li>
<li>可以通过  <code>Constant Score</code> 将查询转换成一个 <code>filtering</code> ，避免算分，并利用缓存，提高性能</li>
</ul>
<h2 id="term-查询"><a href="#term-查询" class="headerlink" title="term 查询"></a>term 查询</h2><p>我们现在有数据如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;test&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;ID10032_1194_1634175220_535254&quot;,</span><br><span class="line">  &quot;_score&quot; : 6.151313,</span><br><span class="line">  &quot;_source&quot; : &#123;</span><br><span class="line">    &quot;user_id&quot; : 10032,</span><br><span class="line">    &quot;consultant_company_id&quot; : 1194,</span><br><span class="line">    &quot;type&quot; : 9,</span><br><span class="line">    &quot;source&quot; : 1,</span><br><span class="line">    &quot;operation_at&quot; : 1634175220,</span><br><span class="line">    &quot;create_time&quot; : &quot;2021-10-14 09:33:40&quot;,</span><br><span class="line">    &quot;update_time&quot; : &quot;2021-10-14 09:33:40&quot;,</span><br><span class="line">    &quot;login_type&quot; : 3,</span><br><span class="line">    &quot;true_name&quot; : &quot;张三&quot;,</span><br><span class="line">    &quot;id&quot; : &quot;ID10032_1194_1634175220_535254&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们使用<code>match</code>查询</p>
<p>这里<code>ID10032_1194_1634175220_535254</code>大写<code>id10032_1194_1634175220_535254</code>小写都可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET test_user_action_detail/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;id&quot;: &quot;ID10032_1194_1634175220_535254&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>都可以得到搜索结果</p>
<p>如果使用 <code>term</code> 查询,<code>id10032_1194_1634175220_535254</code>可以查询到数据，但是如果是<code>ID10032_1194_1634175220_535254</code>大写，那么<code>term</code> 查询就查询不到数据了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET test_user_action_detail/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;id&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;id10032_1194_1634175220_535254&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原因在于 该 id 字段的 <code>mapping</code> 是 text&#x2F;keyword</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;id&quot; : &#123;</span><br><span class="line">  &quot;type&quot; : &quot;text&quot;,</span><br><span class="line">  &quot;fields&quot; : &#123;</span><br><span class="line">    &quot;keyword&quot; : &#123;</span><br><span class="line">      &quot;type&quot; : &quot;keyword&quot;,</span><br><span class="line">      &quot;ignore_above&quot; : 256</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>text</code>数据类型会进行分词，也就是大写会被分词成小写。所以text的id数据实际会变成小写<code>id10032_1194_1634175220_535254</code>，而<code>term</code>查询区分大小写，会进行精确匹配，如果只有搜索小写才能搜索出来结果。如果不想进行分词，那么可以使用<code>keyword</code>字段类型搜索，把<code>term</code>查询语句改成下面这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET test_user_action_detail/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;id.keyword&quot;: &#123;   //这里使用keyword字段查询</span><br><span class="line">        &quot;value&quot;: &quot;ID10032_1194_1634175220_535254&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就可以得到结果了，因为<code>keyword</code>不进行分词，所以插入的<code>ID10032_1194_1634175220_535254</code>就还是<code>ID10032_1194_1634175220_535254</code>，不过注意，这样的话小写<code>id10032_1194_1634175220_535254</code>就搜索不到结果了</p>
<h2 id="filter-不进行算分"><a href="#filter-不进行算分" class="headerlink" title="filter 不进行算分"></a>filter 不进行算分</h2><p>对于term查询来说，其实没必要算分，因为是精确搜索，那么就可以使用<code>filter</code>查询来避免算分并可以有效利用缓存，可以提升性能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET test_user_action_detail/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;constant_score&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;id.keyword&quot;: &#123;</span><br><span class="line">            &quot;value&quot;: &quot;ID10032_1194_1634175220_535254&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基于全文查询"><a href="#基于全文查询" class="headerlink" title="基于全文查询"></a>基于全文查询</h2><ul>
<li><p>match query  &#x2F; match phrase query &#x2F; query string query</p>
</li>
<li><p>特点</p>
<ul>
<li>索引和搜索都会进行分词，查询字符串先传递到一个合适的分词器，然后生成一个供查询的词项列表</li>
<li>查询时，会先分词，然后对每个词都进行查询，最终将结果进行合并。并为每个文档生成一个算分。</li>
<li>例如查询<code>matrx reloaded</code> 会查询到 <code>matrx</code> 和 <code>reloaded</code>两个词的搜索结果，然后进行合并。</li>
</ul>
</li>
</ul>
<h2 id="range-query"><a href="#range-query" class="headerlink" title="range query"></a>range query</h2><p>range 可以进行范围查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">range: &#123;</span><br><span class="line">  created_at: &#123;</span><br><span class="line">    gt:&#x27;1889237773&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="exists-query"><a href="#exists-query" class="headerlink" title="exists query"></a>exists query</h2><p>可以判断值是否存在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exists:&#123;</span><br><span class="line">  field:&quot;created_at&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="处理多值字段"><a href="#处理多值字段" class="headerlink" title="处理多值字段"></a>处理多值字段</h2><p>比如有一个数组 <code>[北京市，上海市]</code></p>
<p>如果我们使用<code>term</code>查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET test_user_action_detail/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;city.keyword&quot;: &#123; </span><br><span class="line">        &quot;value&quot;: &quot;北京市&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>就会搜索出现上面的数据，因为对于数组来说，term 查询是只要包含那么就会搜索出来。</p>
<blockquote>
<p>极客时间 ES 学习笔记</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/nginx%E4%BA%8C.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/nginx%E4%BA%8C.html" class="post-title-link" itemprop="url">nginx二 -- 初识nginx</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-08 10:12:47" itemprop="dateCreated datePublished" datetime="2021-10-08T10:12:47+08:00">2021-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
            </span>

          
            <span id="/nginx%E4%BA%8C.html" class="post-meta-item leancloud_visitors" data-flag-title="nginx二 -- 初识nginx" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/nginx%E4%BA%8C.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/nginx%E4%BA%8C.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h1><h2 id="nginx的场景"><a href="#nginx的场景" class="headerlink" title="nginx的场景"></a>nginx的场景</h2><p>三个主要场景</p>
<ul>
<li>静态资源：通过本地文件系统提供服务</li>
<li>反向代理：nginx的强大性能，缓存，负载均衡</li>
<li>API服务：openresty</li>
</ul>
<h2 id="nginx的优点"><a href="#nginx的优点" class="headerlink" title="nginx的优点"></a>nginx的优点</h2><ul>
<li>高并发，高性能</li>
<li>可扩展性好</li>
<li>高可靠性</li>
<li>热部署</li>
<li>BSD许可证</li>
</ul>
<h2 id="nginx的组成"><a href="#nginx的组成" class="headerlink" title="nginx的组成"></a>nginx的组成</h2><ul>
<li>nginx二进制可执行文件：由各模块原码编译出的一个文件</li>
<li>nginx.conf:控制nginx行为</li>
<li>access.log</li>
<li>error.log</li>
</ul>
<h2 id="vim-nginx语法高亮"><a href="#vim-nginx语法高亮" class="headerlink" title="vim nginx语法高亮"></a>vim nginx语法高亮</h2><p>如果想要vim操作nginx的时候有语法高亮，那么只需要把nginx文件夹带的vim配置文件复制到自己的vim配置文件下面就可以了</p>
<p>找到nginx源码目录，注意这里是源码目录，下载的tar包解压出来的目录，而不是编译安装后的目录，下面有一个<code>contrib</code>文件夹，这个文件夹里面有<code>vim</code>文件夹，把这个里面的配置文件都复制一下就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r nginx/contrib/vim/ ~/.vim/</span><br></pre></td></tr></table></figure>

<h2 id="已安装的nginx-增加模块"><a href="#已安装的nginx-增加模块" class="headerlink" title="已安装的nginx 增加模块"></a>已安装的nginx 增加模块</h2><p>首先到达源码目录<code>cd /usr/local/src/nginx1.19</code></p>
<p>然后开始编译</p>
<ul>
<li>–prefix 参数代表你的nginx安装目录，如果是已安装的nginx，那么这个目录就选择已安装的目录，没有安装的可以随便选想安装到的目录</li>
<li>–with 开头的代表你想开启的模块</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./configure --with-file-aio --with-http_ssl_module --with-http_v2_module --with-http_realip_module --prefix=/usr/local/src/nginx</span><br></pre></td></tr></table></figure>

<p>然后执行<code>make</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make</span><br></pre></td></tr></table></figure>

<p>接下来就可以复制nginx源文件了，这里只执行make，不需要执行make install</p>
<p>现在假设你已经在nginx源码目录了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ./objs  //移动到objs目录下</span><br><span class="line">cp nginx /usr/local/src/nginx/sbin/    //把objs目录下的nginx复制到你原来的nginx安装目录下面的sbin目录替换原来的nginx源文件</span><br></pre></td></tr></table></figure>

<p>如果是新安装，那么不需要复制，直接执行 sudo make install 就可以了</p>
<h2 id="配置语法"><a href="#配置语法" class="headerlink" title="配置语法"></a>配置语法</h2><ul>
<li>配置文件由指令和指令块构成</li>
<li>每条指令以;分号结尾，指令与参数间用空格分隔</li>
<li>指令块以{}大括号将多条指令组织在一起</li>
<li>include 语句允许组合多个配置文件以提升可维护性</li>
<li>使用 #井号添加注释，提高可读性</li>
<li>使用 $符号作为变量</li>
<li>部分指令的参数支持正则表达式</li>
</ul>
<h2 id="http配置的指令块"><a href="#http配置的指令块" class="headerlink" title="http配置的指令块"></a>http配置的指令块</h2><ul>
<li>http</li>
<li>server</li>
<li>upstream</li>
<li>location</li>
</ul>
<h2 id="nginx-命令行"><a href="#nginx-命令行" class="headerlink" title="nginx 命令行"></a>nginx 命令行</h2><ul>
<li>帮助 -h</li>
<li>指定配置文件 -c</li>
<li>指定配置指令 -g</li>
<li>指定运行目录 -p</li>
<li>发送信号 -s</li>
<li>测试配置文件语法 -t</li>
<li>打印版本信息 -v -V</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nginx             //启动</span><br><span class="line">nginx -s reload   // 重启</span><br><span class="line">nginx -s quit    //优雅停止</span><br><span class="line">nginx -s stop    //直接停止</span><br><span class="line">nginx -s reopen  //重新开始记录日志</span><br></pre></td></tr></table></figure>

<h4 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h4><p>当你需要升级nginx或者增加模块的时候可以使用热部署的方式平滑过渡，不需要重启</p>
<p>查看现在nginx进程的id</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep nginx</span><br></pre></td></tr></table></figure>

<p>对现在的nginx进程发送<code>USR2</code>信号进行热部署</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR2 id</span><br></pre></td></tr></table></figure>

<p>现在可以看到新的nginx进程和老的nginx进程都存在了，这个时候我们需要让老的nginx进程平滑退出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -WINCH id</span><br></pre></td></tr></table></figure>

<p>接下来就可以看到老的nginx的worker进程全部平滑退出了，但是老的master进程还在，这是为了防止新的有问题，还可以退回老的</p>
<p>如果接下来新的有问题，那么我们退回老的，发送<code>HUP</code>信号，而不是直接reload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -HUP id</span><br></pre></td></tr></table></figure>

<p>接下来可以看到老的worker进程都起来了</p>
<p>如果热部署后没有问题的话，那么我们直接删除老的master进程就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT id</span><br></pre></td></tr></table></figure>

<h4 id="日志切割"><a href="#日志切割" class="headerlink" title="日志切割"></a>日志切割</h4><p>如果我们觉得日志太大可以进行日志切割，一种是发送<code>reopen</code>信号，还有一种是发送<code>USR1</code>信号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -s reopen</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR1 id</span><br></pre></td></tr></table></figure>

<p>但是注意切割之前要把之前的日志备份一下，不然就会被删除啦</p>
<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>反向代理配置在<code>http</code>代码块中</p>
<p>首先通过<code>upstream</code>配置反向代理的服务器</p>
<p>test 是一个名称，可以随便取</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> test&#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8080</span>     <span class="comment"># 上游服务器的地址，可以写多个</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 <code>proxy_pass</code> 进行反向代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://test;   # 这里填写上面的upstream名字</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候我们访问80端口实际上访问的是8080端口</p>
<h4 id="反向代理的缓存"><a href="#反向代理的缓存" class="headerlink" title="反向代理的缓存"></a>反向代理的缓存</h4><p>反向代理之后还可以在反向代理服务器做缓存</p>
<p>在<code>nginx.conf</code>文件的<code>http</code>代码块中设置缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 设置缓存路径 /tmp/nginxCache 缓存名称 my_cache</span><br><span class="line">proxy_cache_path /tmp/nginxCache levels=1:2 keys_zone=my_cache:10m max_size=10g inactive=60m use_temp_path=off;</span><br></pre></td></tr></table></figure>

<p>接下来在我们的反向代理<code>server/location</code>代码块里面使用这个缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_cache my_cache;   # 使用上面定义的缓存</span><br><span class="line">    proxy_cache_key $host$uri$is_args$args;  # 缓存的key值，根据host uri和参数来做key</span><br><span class="line">    proxy_cache_valid 200 304 302 1d;   # 缓存200 304 302状态 缓存时间1d = 1天</span><br><span class="line">    proxy_pass http://test;   # 这里填写上面的upstream名字</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="goaccess-日志可视化"><a href="#goaccess-日志可视化" class="headerlink" title="goaccess 日志可视化"></a>goaccess 日志可视化</h2><p>goaccess 是一个c语言写的日志可视化工具</p>
<p>直接编译安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://tar.goaccess.io/goaccess-1.2.tar.gz</span><br><span class="line">tar -xzvf goaccess-1.2.tar.gz</span><br><span class="line">cd goaccess-1.2/</span><br><span class="line">./configure --enable-utf8</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>然后就可以启动了，直接启动就可以</p>
<p>指定日志文件路径 <code>/usr/local/src/nginx/logs/access.log</code> -o 输出到某个html文件中 –real-time-html 代表实时刷新, –log-format 代表日志格式 ，–daemonize 代表守护进程后台执行 仅在 开启了 –real-time-html 实时刷新有效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goaccess /usr/local/src/nginx/logs/access.log -o ~/wwwroot/goaccess.html --real-time-html --log-format=COMBINED --daemonize</span><br></pre></td></tr></table></figure>

<p>这里要注意，如果开启了  –real-time-html 实时刷新，那么会启动一个 socket 进程监听 7890 端口，所以 7890 端口要开放才行</p>
<p>可以配置 nginx 文件访问这个输出的 html 文件了，就可以看到一个可视化界面了</p>
<h2 id="ssl"><a href="#ssl" class="headerlink" title="ssl"></a>ssl</h2><p>ssl(Secure Sosckets Layer)<br>tls(Transport Layer Security)</p>
<ul>
<li>1995年-ssl3.0</li>
<li>1999 - tls1.0</li>
<li>2006 - tls1.1</li>
<li>2008 - tls1.2</li>
<li>2018 - tls1.3</li>
</ul>
<p>ssl&#x2F;tls 运行在 <code>ISO7层模型的表示层中</code>，而http协议运行在表示层的上层<code>应用层</code>。在http的数据传输到<code>表示层</code>以后，ssl&#x2F;tls就会对数据进行加密</p>
<ul>
<li>握手</li>
<li>交换秘钥</li>
<li>告警</li>
<li>对称加密的应用数据</li>
</ul>
<p>tls安全套件</p>
<blockquote>
<p>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</p>
</blockquote>
<ul>
<li>tls代表tls加密</li>
<li>ECDHE 代表秘钥交换算法</li>
<li>RSA 代表身份验证算法</li>
<li>AES 代表对称加密算法</li>
<li>128 代表强度</li>
<li>GCM 代表分组模式</li>
<li>SHA256 代表签名 hash 算法</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/nginx%E4%B8%80.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/nginx%E4%B8%80.html" class="post-title-link" itemprop="url">nginx一 -- 初识nginx</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-04 10:12:47" itemprop="dateCreated datePublished" datetime="2021-10-04T10:12:47+08:00">2021-10-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
            </span>

          
            <span id="/nginx%E4%B8%80.html" class="post-meta-item leancloud_visitors" data-flag-title="nginx一 -- 初识nginx" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/nginx%E4%B8%80.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/nginx%E4%B8%80.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h1><h2 id="nginx的场景"><a href="#nginx的场景" class="headerlink" title="nginx的场景"></a>nginx的场景</h2><p>三个主要场景</p>
<ul>
<li>静态资源：通过本地文件系统提供服务</li>
<li>反向代理：nginx的强大性能，缓存，负载均衡</li>
<li>API服务：openresty</li>
</ul>
<h2 id="nginx的优点"><a href="#nginx的优点" class="headerlink" title="nginx的优点"></a>nginx的优点</h2><ul>
<li>高并发，高性能</li>
<li>可扩展性好</li>
<li>高可靠性</li>
<li>热部署</li>
<li>BSD许可证</li>
</ul>
<h2 id="nginx的组成"><a href="#nginx的组成" class="headerlink" title="nginx的组成"></a>nginx的组成</h2><ul>
<li>nginx二进制可执行文件：由各模块原码编译出的一个文件</li>
<li>nginx.conf:控制nginx行为</li>
<li>access.log</li>
<li>error.log</li>
</ul>
<h2 id="vim-nginx语法高亮"><a href="#vim-nginx语法高亮" class="headerlink" title="vim nginx语法高亮"></a>vim nginx语法高亮</h2><p>如果想要vim操作nginx的时候有语法高亮，那么只需要把nginx文件夹带的vim配置文件复制到自己的vim配置文件下面就可以了</p>
<p>找到nginx源码目录，注意这里是源码目录，下载的tar包解压出来的目录，而不是编译安装后的目录，下面有一个<code>contrib</code>文件夹，这个文件夹里面有<code>vim</code>文件夹，把这个里面的配置文件都复制一下就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r nginx/contrib/vim/ ~/.vim/</span><br></pre></td></tr></table></figure>

<h2 id="已安装的nginx-增加模块"><a href="#已安装的nginx-增加模块" class="headerlink" title="已安装的nginx 增加模块"></a>已安装的nginx 增加模块</h2><p>首先到达源码目录<code>cd /usr/local/src/nginx1.19</code></p>
<p>然后开始编译</p>
<ul>
<li>–prefix 参数代表你的nginx安装目录，如果是已安装的nginx，那么这个目录就选择已安装的目录，没有安装的可以随便选想安装到的目录</li>
<li>–with 开头的代表你想开启的模块</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./configure --with-file-aio --with-http_ssl_module --with-http_v2_module --with-http_realip_module --prefix=/usr/local/src/nginx</span><br></pre></td></tr></table></figure>

<p>然后执行<code>make</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make</span><br></pre></td></tr></table></figure>

<p>接下来就可以复制nginx源文件了，这里只执行make，不需要执行make install</p>
<p>现在假设你已经在nginx源码目录了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ./objs  //移动到objs目录下</span><br><span class="line">cp nginx /usr/local/src/nginx/sbin/    //把objs目录下的nginx复制到你原来的nginx安装目录下面的sbin目录替换原来的nginx源文件</span><br></pre></td></tr></table></figure>

<p>如果是新安装，那么不需要复制，直接执行 sudo make install 就可以了</p>
<h2 id="配置语法"><a href="#配置语法" class="headerlink" title="配置语法"></a>配置语法</h2><ul>
<li>配置文件由指令和指令块构成</li>
<li>每条指令以;分号结尾，指令与参数间用空格分隔</li>
<li>指令块以{}大括号将多条指令组织在一起</li>
<li>include 语句允许组合多个配置文件以提升可维护性</li>
<li>使用 #井号添加注释，提高可读性</li>
<li>使用 $符号作为变量</li>
<li>部分指令的参数支持正则表达式</li>
</ul>
<h2 id="http配置的指令块"><a href="#http配置的指令块" class="headerlink" title="http配置的指令块"></a>http配置的指令块</h2><ul>
<li>http</li>
<li>server</li>
<li>upstream</li>
<li>location</li>
</ul>
<h2 id="nginx-命令行"><a href="#nginx-命令行" class="headerlink" title="nginx 命令行"></a>nginx 命令行</h2><ul>
<li>帮助 -h</li>
<li>指定配置文件 -c</li>
<li>指定配置指令 -g</li>
<li>指定运行目录 -p</li>
<li>发送信号 -s</li>
<li>测试配置文件语法 -t</li>
<li>打印版本信息 -v -V</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nginx             //启动</span><br><span class="line">nginx -s reload   // 重启</span><br><span class="line">nginx -s quit    //优雅停止</span><br><span class="line">nginx -s stop    //直接停止</span><br><span class="line">nginx -s reopen  //重新开始记录日志</span><br></pre></td></tr></table></figure>

<h4 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h4><p>当你需要升级nginx或者增加模块的时候可以使用热部署的方式平滑过渡，不需要重启</p>
<p>查看现在nginx进程的id</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep nginx</span><br></pre></td></tr></table></figure>

<p>对现在的nginx进程发送<code>USR2</code>信号进行热部署</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR2 id</span><br></pre></td></tr></table></figure>

<p>现在可以看到新的nginx进程和老的nginx进程都存在了，这个时候我们需要让老的nginx进程平滑退出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -WINCH id</span><br></pre></td></tr></table></figure>

<p>接下来就可以看到老的nginx的worker进程全部平滑退出了，但是老的master进程还在，这是为了防止新的有问题，还可以退回老的</p>
<p>如果接下来新的有问题，那么我们退回老的，发送<code>HUP</code>信号，而不是直接reload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -HUP id</span><br></pre></td></tr></table></figure>

<p>接下来可以看到老的worker进程都起来了</p>
<p>如果热部署后没有问题的话，那么我们直接删除老的master进程就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT id</span><br></pre></td></tr></table></figure>

<h4 id="日志切割"><a href="#日志切割" class="headerlink" title="日志切割"></a>日志切割</h4><p>如果我们觉得日志太大可以进行日志切割，一种是发送<code>reopen</code>信号，还有一种是发送<code>USR1</code>信号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -s reopen</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -USR1 id</span><br></pre></td></tr></table></figure>

<p>但是注意切割之前要把之前的日志备份一下，不然就会被删除啦</p>
<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>反向代理配置在<code>http</code>代码块中</p>
<p>首先通过<code>upstream</code>配置反向代理的服务器</p>
<p>test 是一个名称，可以随便取</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> test&#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8080</span>     <span class="comment"># 上游服务器的地址，可以写多个</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 <code>proxy_pass</code> 进行反向代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://test;   # 这里填写上面的upstream名字</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候我们访问80端口实际上访问的是8080端口</p>
<h4 id="反向代理的缓存"><a href="#反向代理的缓存" class="headerlink" title="反向代理的缓存"></a>反向代理的缓存</h4><p>反向代理之后还可以在反向代理服务器做缓存</p>
<p>在<code>nginx.conf</code>文件的<code>http</code>代码块中设置缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 设置缓存路径 /tmp/nginxCache 缓存名称 my_cache</span><br><span class="line">proxy_cache_path /tmp/nginxCache levels=1:2 keys_zone=my_cache:10m max_size=10g inactive=60m use_temp_path=off;</span><br></pre></td></tr></table></figure>

<p>接下来在我们的反向代理<code>server/location</code>代码块里面使用这个缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_cache my_cache;   # 使用上面定义的缓存</span><br><span class="line">    proxy_cache_key $host$uri$is_args$args;  # 缓存的key值，根据host uri和参数来做key</span><br><span class="line">    proxy_cache_valid 200 304 302 1d;   # 缓存200 304 302状态 缓存时间1d = 1天</span><br><span class="line">    proxy_pass http://test;   # 这里填写上面的upstream名字</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="goaccess-日志可视化"><a href="#goaccess-日志可视化" class="headerlink" title="goaccess 日志可视化"></a>goaccess 日志可视化</h2><p>goaccess 是一个c语言写的日志可视化工具</p>
<p>直接编译安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://tar.goaccess.io/goaccess-1.2.tar.gz</span><br><span class="line">tar -xzvf goaccess-1.2.tar.gz</span><br><span class="line">cd goaccess-1.2/</span><br><span class="line">./configure --enable-utf8</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>然后就可以启动了，直接启动就可以</p>
<p>指定日志文件路径 <code>/usr/local/src/nginx/logs/access.log</code> -o 输出到某个html文件中 –real-time-html 代表实时刷新, –log-format 代表日志格式 ，–daemonize 代表守护进程后台执行 仅在 开启了 –real-time-html 实时刷新有效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goaccess /usr/local/src/nginx/logs/access.log -o ~/wwwroot/goaccess.html --real-time-html --log-format=COMBINED --daemonize</span><br></pre></td></tr></table></figure>

<p>这里要注意，如果开启了  –real-time-html 实时刷新，那么会启动一个 socket 进程监听 7890 端口，所以 7890 端口要开放才行</p>
<p>可以配置 nginx 文件访问这个输出的 html 文件了，就可以看到一个可视化界面了</p>
<h2 id="ssl"><a href="#ssl" class="headerlink" title="ssl"></a>ssl</h2><p>ssl(Secure Sosckets Layer)<br>tls(Transport Layer Security)</p>
<ul>
<li>1995年-ssl3.0</li>
<li>1999 - tls1.0</li>
<li>2006 - tls1.1</li>
<li>2008 - tls1.2</li>
<li>2018 - tls1.3</li>
</ul>
<p>ssl&#x2F;tls 运行在 <code>ISO7层模型的表示层中</code>，而http协议运行在表示层的上层<code>应用层</code>。在http的数据传输到<code>表示层</code>以后，ssl&#x2F;tls就会对数据进行加密</p>
<ul>
<li>握手</li>
<li>交换秘钥</li>
<li>告警</li>
<li>对称加密的应用数据</li>
</ul>
<p>tls安全套件</p>
<blockquote>
<p>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</p>
</blockquote>
<ul>
<li>tls代表tls加密</li>
<li>ECDHE 代表秘钥交换算法</li>
<li>RSA 代表身份验证算法</li>
<li>AES 代表对称加密算法</li>
<li>128 代表强度</li>
<li>GCM 代表分组模式</li>
<li>SHA256 代表签名 hash 算法</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0.html" class="post-title-link" itemprop="url">学堂在线C++程序设计第十四章学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-01 10:12:47" itemprop="dateCreated datePublished" datetime="2021-09-01T10:12:47+08:00">2021-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          
            <span id="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0.html" class="post-meta-item leancloud_visitors" data-flag-title="学堂在线C++程序设计第十四章学习笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="学堂在线C-程序设计第十四章学习笔记"><a href="#学堂在线C-程序设计第十四章学习笔记" class="headerlink" title="学堂在线C++程序设计第十四章学习笔记"></a>学堂在线C++程序设计第十四章学习笔记</h1><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="comment">//抛出异常</span></span><br><span class="line">&#125; <span class="built_in">catch</span> (异常) &#123;</span><br><span class="line">    <span class="comment">//异常处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异常接口声明</p>
<ul>
<li>一个函数显式声明可能抛出的异常，有利于函数的调用者为异常处理做好准备</li>
<li>void fun() throw(A,B,C)</li>
<li>若无异常接口声明，则可以抛出任何类型的异常</li>
<li>不抛任何类型异常的函数声明如下：<br>  void fun() throw()</li>
</ul>
<h3 id="异常处理的构造与析构"><a href="#异常处理的构造与析构" class="headerlink" title="异常处理的构造与析构"></a>异常处理的构造与析构</h3><p>自动的析构</p>
<ul>
<li>找到一个匹配的catch异常处理后</li>
<li>初始化异常参数</li>
<li>将从对应的try块开始到异常被抛出之间构造（且尚未析构）的所有自动对象进行析构</li>
<li>从最后一个catch处理之后开始恢复执行</li>
</ul>
<h3 id="标准程序库异常处理"><a href="#标准程序库异常处理" class="headerlink" title="标准程序库异常处理"></a>标准程序库异常处理</h3><p>基础</p>
<ul>
<li>exception</li>
<li>logic_error 表示可以被预先检测到的异常<ul>
<li>这类异常可以避免</li>
</ul>
</li>
<li>runtime_error 表示难以被预先检测到的异常</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0.html" class="post-title-link" itemprop="url">学堂在线C++程序设计第十三章学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-31 10:12:47" itemprop="dateCreated datePublished" datetime="2021-08-31T10:12:47+08:00">2021-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          
            <span id="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0.html" class="post-meta-item leancloud_visitors" data-flag-title="学堂在线C++程序设计第十三章学习笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="学堂在线C-程序设计第十三章学习笔记"><a href="#学堂在线C-程序设计第十三章学习笔记" class="headerlink" title="学堂在线C++程序设计第十三章学习笔记"></a>学堂在线C++程序设计第十三章学习笔记</h1><h2 id="流类库与输入输出"><a href="#流类库与输入输出" class="headerlink" title="流类库与输入输出"></a>流类库与输入输出</h2><h3 id="IO流的概念"><a href="#IO流的概念" class="headerlink" title="IO流的概念"></a>IO流的概念</h3><p>当程序与外界环境进行信息交换时，存在着两个对象，一个是程序中的对象，另一个是文件对象</p>
<p><code>流</code>是信息流动的抽象，负责在数据的<code>生产者</code>和<code>消费者</code>之间建立联系，并管理数据的流动</p>
<p>流对象与文件操作</p>
<ul>
<li>建立流对象</li>
<li>指定这个流对象与某个文件对象建立连接</li>
<li>程序操作流对象</li>
<li>流对象通过文件系统对所连接的文件对象产生作用</li>
</ul>
<p>提取与插入</p>
<ul>
<li>读操作从流中提取</li>
<li>写操作向流中写入</li>
</ul>
<h3 id="输出流"><a href="#输出流" class="headerlink" title="输出流"></a>输出流</h3><p>最重要的三个输出流</p>
<ul>
<li>ostream</li>
<li>ofstream</li>
<li>ostringstream</li>
</ul>
<p>预先定义的输出流对象</p>
<ul>
<li>cout 标准输出</li>
<li>cerr 标准错误输出，没有缓冲，发送给它的内容立即被输出</li>
<li>clog 类似cerr，但是有缓冲，缓冲区满时被输出</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ofstream <span class="title">fout</span><span class="params">(<span class="string">&#x27;123.log&#x27;</span>)</span></span>;</span><br><span class="line">streamBuf* old = cout.<span class="built_in">rdbuf</span>(fout.<span class="built_in">rdbuf</span>());</span><br><span class="line"><span class="comment">//cout 输出到123.log文件</span></span><br><span class="line">cout.<span class="built_in">rdbuf</span>(old); <span class="comment">//恢复输出到标准输出</span></span><br></pre></td></tr></table></figure>

<p>构造输出流对象</p>
<ul>
<li>ofstream 类支持磁盘文件输出</li>
<li>如果在构造函数中指定文件名，当构造这个文件时该文件时自动打开的<br>  ofstream fout(‘123.log’);</li>
<li>可以在调用默认构造函数后使用open打开文件<br>  ofstream fout;<br>  fout.open(123.log);</li>
<li>打开文件可以指定模式<br>  ofstream fout(‘123.log’, ios_base::out|ios_base::binary);</li>
</ul>
<p>文件输出流成员函数的三种类型</p>
<ul>
<li>与操纵符等价的成员函数</li>
<li>执行非格式化写操作的成员函数</li>
<li>其他修改流状态且不同于操纵符或插入运算符的成员函数</li>
</ul>
<p>成员函数</p>
<ul>
<li>open<ul>
<li>把流与磁盘文件关联</li>
<li>需要指定打开模式</li>
</ul>
</li>
<li>put<ul>
<li>把一个字符写到输出流</li>
</ul>
</li>
<li>write<ul>
<li>将内存中的一块内容写到一个文件输出，可以写二进制</li>
</ul>
</li>
<li>seekp和 tellp<ul>
<li>操作文件流的内部指针</li>
</ul>
</li>
<li>close<ul>
<li>关闭磁盘文件</li>
</ul>
</li>
<li>错误处理函数<ul>
<li>在写到一个流时进行错误处理</li>
</ul>
</li>
</ul>
<h4 id="向文本文件输出"><a href="#向文本文件输出" class="headerlink" title="向文本文件输出"></a>向文本文件输出</h4><p>插入运算符 &lt;&lt;</p>
<ul>
<li>为所有标准C++数据类型设计的，用于传送一个字节到输出流对象</li>
</ul>
<p>操纵符（manipulator）</p>
<ul>
<li>插入运算符和操纵符一起<br>  控制输出格式</li>
<li>很多操纵符都定义在 ios_base类中，如hex()，<iomanip>头文件中，如setprecision()</li>
<li>控制输出宽度<br>  在流中放入setw操纵符或调用width成员函数</li>
<li>setw和 width只影响紧随其后的输出项，但其他流格式操纵符保持有效直到发生改变</li>
<li>dec,oct和 hex操纵符设置输入输出的默认进制</li>
</ul>
<p>精度</p>
<ul>
<li>浮点数输出精度的默认值是6</li>
<li>改变精度使用 setprecision操纵符，定义在 <iomanip> 头文件中</li>
<li>如果不指定 fixed 或 scientifc,精度值表示有效数字位数</li>
<li>如果设置了 ios_base::fixed 定点形式 或 ios_base::scientifc 科学计数法 ，精度值表示小数点之后的位数</li>
</ul>
<h4 id="向二进制文件输出"><a href="#向二进制文件输出" class="headerlink" title="向二进制文件输出"></a>向二进制文件输出</h4><p>二进制文件流</p>
<ul>
<li>使用ofstream构造函数中的模式指定二进制</li>
<li>以通常方式构造一个流，然后使用setmode成员函数，在文件打开后改变模式</li>
<li>通过二进制文件输出流对象完成输出</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> b[<span class="number">3</span>] =&#123;<span class="number">912</span>,<span class="number">2456</span>,<span class="number">37890</span>&#125;;</span><br><span class="line">    <span class="function">ofstream <span class="title">file</span><span class="params">(<span class="string">&quot;date.bat&quot;</span>, ios_base::binary)</span></span>;</span><br><span class="line">    file.<span class="built_in">write</span>(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span> *&gt; (&amp;b), <span class="built_in">sizeof</span>(b));</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="向字符串输出"><a href="#向字符串输出" class="headerlink" title="向字符串输出"></a>向字符串输出</h4><ul>
<li>用于构造字符串</li>
<li>功能<ul>
<li>支持ofstream类的除了open,close外的所有操作</li>
<li>str函数可以返回当前已构造的字符串</li>
</ul>
</li>
<li>典型应用<ul>
<li>将数值转换为字符串</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ostringstream os;</span><br><span class="line">os &lt;&lt; <span class="number">123</span>;</span><br><span class="line">string s = os.<span class="built_in">str</span>();</span><br></pre></td></tr></table></figure>

<h3 id="输入流"><a href="#输入流" class="headerlink" title="输入流"></a>输入流</h3><p>重要的输入流类</p>
<ul>
<li>istream 最适用于顺序文本输入，cin是他的实例</li>
<li>ifstream 支持磁盘文件输入</li>
<li>istringstream 字符串输入</li>
</ul>
<p>构造输入流对象</p>
<ul>
<li>如果在构造函数中指定文件，在构造对象时自动打开<br>  ifstream ifs(‘data.bat’);</li>
<li>调用默认构造函数后使用open打开<br>  ifstream ifs;<br>  ifs.open(‘data.bat’);</li>
<li>打开文件时可以指定模式</li>
</ul>
<p>输入流相关函数</p>
<ul>
<li>open 把输入流和文件关联</li>
<li>get 函数的功能与提取运算符(&gt;&gt;)很像，主要的不同点是get函数在读入数据时包括空白字符</li>
<li>getLine 的功能是读取多个字符，并且可以指定终止字符，读取完成后，从读取内容中删除终止字符</li>
<li>read 函数从一个文件读字节到内存中的指定区域，由长度确定要读的字节数。当遇到文件结束或在文本模式文件中遇到文件结束标记字符时结束读取。可以读取二进制。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> b[<span class="number">3</span>] =&#123;<span class="number">912</span>,<span class="number">2456</span>,<span class="number">37890</span>&#125;;</span><br><span class="line">    <span class="function">ofstream <span class="title">file</span><span class="params">(<span class="string">&quot;date&quot;</span>, ios_base::binary)</span></span>;</span><br><span class="line">    file.<span class="built_in">write</span>(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span> *&gt; (b), <span class="built_in">sizeof</span>(b));</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">    <span class="type">int</span> i2;</span><br><span class="line">    <span class="function">ifstream <span class="title">mfile</span><span class="params">(<span class="string">&quot;date&quot;</span>, ios_base::binary)</span></span>;</span><br><span class="line">    mfile.<span class="built_in">seekg</span>(<span class="number">2</span> * <span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    mfile.<span class="built_in">read</span>(<span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span> *&gt;(&amp;i2), <span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    cout &lt;&lt; i2 &lt;&lt;endl;</span><br><span class="line">    mfile.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="字符串输入"><a href="#字符串输入" class="headerlink" title="字符串输入"></a>字符串输入</h4><p>用于从字符串读取数据</p>
<h4 id="输入输出流"><a href="#输入输出流" class="headerlink" title="输入输出流"></a>输入输出流</h4><p>输入输出流都是从iostream派生的</p>
<ul>
<li>fstream</li>
<li>stringstream</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E4%B8%89%E8%8A%82.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E4%B8%89%E8%8A%82.html" class="post-title-link" itemprop="url">数据库系统原理第十三节</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-28 10:12:47" itemprop="dateCreated datePublished" datetime="2021-08-28T10:12:47+08:00">2021-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">数据库系统原理</span></a>
                </span>
            </span>

          
            <span id="/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E4%B8%89%E8%8A%82.html" class="post-meta-item leancloud_visitors" data-flag-title="数据库系统原理第十三节" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E4%B8%89%E8%8A%82.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E4%B8%89%E8%8A%82.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="数据库系统原理第十三节"><a href="#数据库系统原理第十三节" class="headerlink" title="数据库系统原理第十三节"></a>数据库系统原理第十三节</h1><h2 id="数据库安全和保护"><a href="#数据库安全和保护" class="headerlink" title="数据库安全和保护"></a>数据库安全和保护</h2><h3 id="安全性与访问控制"><a href="#安全性与访问控制" class="headerlink" title="安全性与访问控制"></a>安全性与访问控制</h3><p>数据库安全：指保护数据库以防止不合法的使用而造成数据泄露，更改或破坏，所以安全性对于任何一个DBMS来说都是至关重要的</p>
<ul>
<li>身份验证</li>
<li>数据库用户权限确认</li>
</ul>
<p>查看用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> mysql.user</span><br></pre></td></tr></table></figure>

<p>创建用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="keyword">user</span>[identified <span class="keyword">by</span> [password]<span class="string">&#x27;password&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>create user ‘test‘@’%’ identified by ‘123’</p>
<p>create user ‘tset‘@’%’ identified by password ‘jdkfjalkdjskflajsdfa’</p>
<p>删除用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure>

<p>drop user ‘test‘@’%’</p>
<p>修改用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="keyword">user</span> old_user <span class="keyword">to</span> new_user</span><br></pre></td></tr></table></figure>

<p>修改密码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> password <span class="keyword">for</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="operator">=</span> PASSWORD(<span class="string">&#x27;pass&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="账号权限管理"><a href="#账号权限管理" class="headerlink" title="账号权限管理"></a>账号权限管理</h4><p>使用grant 为用户授权</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span></span><br><span class="line">    priv_type[<span class="keyword">column</span>]</span><br><span class="line">    <span class="keyword">on</span> [object_type] priv_level</span><br><span class="line">    <span class="keyword">to</span> <span class="keyword">user</span></span><br><span class="line">    [<span class="keyword">with</span> <span class="keyword">grant</span> option]</span><br></pre></td></tr></table></figure>

<p>grant select (id, name)<br>on test.test_table<br>to test@’localhost’</p>
<h4 id="收回用户权限"><a href="#收回用户权限" class="headerlink" title="收回用户权限"></a>收回用户权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">revoke</span> </span><br><span class="line">    priv_type</span><br><span class="line">    <span class="keyword">on</span> [object_type]</span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure>

<p>revoke select on test.test_table from ‘test‘@’localhost’</p>
<h3 id="事务与并发控制"><a href="#事务与并发控制" class="headerlink" title="事务与并发控制"></a>事务与并发控制</h3><p>所谓事务是用户定义的一个<code>数据操作序列</code>，这些操作可作为一个完整的工作单元，要么全部执行，要么全部不执行，是一个不可分割的工作单位。事务中的操作一般是对数据的更新操作，包括<code>增删改</code></p>
<p>以 <code>begin transaction</code>开始<br>commit 或 rollback结束</p>
<p>事务的特征 </p>
<ul>
<li>A 原子性</li>
<li>C 一致性</li>
<li>I 隔离性</li>
<li>D 持续性</li>
</ul>
<h6 id="并发操作问题"><a href="#并发操作问题" class="headerlink" title="并发操作问题"></a>并发操作问题</h6><ul>
<li>丢失更新</li>
<li>不可重复读</li>
<li>读‘脏’数据</li>
</ul>
<h6 id="封锁"><a href="#封锁" class="headerlink" title="封锁"></a>封锁</h6><p>封锁 是最常用的并发控制技术</p>
<p>基本思想：需要时，事务通过向系统请求对它所希望的数据对象加锁，以确保它不被非预期改变</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E5%9B%9B%E8%8A%82.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E5%9B%9B%E8%8A%82.html" class="post-title-link" itemprop="url">数据库系统原理第十四节</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-28 10:12:47" itemprop="dateCreated datePublished" datetime="2021-08-28T10:12:47+08:00">2021-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">数据库系统原理</span></a>
                </span>
            </span>

          
            <span id="/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E5%9B%9B%E8%8A%82.html" class="post-meta-item leancloud_visitors" data-flag-title="数据库系统原理第十四节" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E5%9B%9B%E8%8A%82.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86%E7%AC%AC%E5%8D%81%E5%9B%9B%E8%8A%82.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="数据库系统原理第十四节"><a href="#数据库系统原理第十四节" class="headerlink" title="数据库系统原理第十四节"></a>数据库系统原理第十四节</h1><h2 id="数据库安全和保护"><a href="#数据库安全和保护" class="headerlink" title="数据库安全和保护"></a>数据库安全和保护</h2><h3 id="事务与并发控制"><a href="#事务与并发控制" class="headerlink" title="事务与并发控制"></a>事务与并发控制</h3><p>所谓事务是用户定义的一个<code>数据操作序列</code>，这些操作可作为一个完整的工作单元，要么全部执行，要么全部不执行，是一个不可分割的工作单位。事务中的操作一般是对数据的更新操作，包括<code>增删改</code></p>
<p>以 <code>begin transaction</code>开始<br>commit 或 rollback结束</p>
<p>事务的特征 </p>
<ul>
<li>A 原子性</li>
<li>C 一致性</li>
<li>I 隔离性</li>
<li>D 持续性</li>
</ul>
<h6 id="并发操作问题"><a href="#并发操作问题" class="headerlink" title="并发操作问题"></a>并发操作问题</h6><ul>
<li>丢失更新</li>
<li>不可重复读</li>
<li>读‘脏’数据</li>
</ul>
<h6 id="封锁"><a href="#封锁" class="headerlink" title="封锁"></a>封锁</h6><p>封锁 是最常用的并发控制技术</p>
<p>基本思想：需要时，事务通过向系统请求对它所希望的数据对象加锁，以确保它不被非预期改变</p>
<p>一个<code>锁</code>实质上就是允许或阻止一个事务对一个数据对象的存取特权</p>
<p>基本的封锁类型</p>
<ul>
<li>排它锁，用于写操作</li>
<li>共享锁，用于读操作</li>
</ul>
<p>封锁的粒度<br>粒度越细，并发性就越大，但软件复杂性和系统开销也就越大</p>
<p><code>封锁的级别</code>又称为一致性级别或隔离度</p>
<ul>
<li>0级封锁：不重写其他非0级封锁事务的未提交的更新数据</li>
<li>1级封锁：不允许重写未提交的更新数据。防止了丢失更新的发生</li>
<li>2级封锁：既不重写也不读未提交的更新数据（防止了读脏数据）</li>
<li>3级封锁：不读未提交的更新数据，不写任何（包括读操作）未提交数据</li>
</ul>
<p>活锁：先来先服务<br>死锁：预防</p>
<ul>
<li>一次性锁请求</li>
<li>锁请求排序</li>
<li>序列化处理</li>
<li>资源剥夺</li>
</ul>
<p>可串行性<br>一组事务的一个调度就是它们的基本操作的一种排序</p>
<p>在数据库系统中，可串行性就是并发执行的<code>正确性准则</code></p>
<p>两段封锁法</p>
<ul>
<li>发展或加锁阶段</li>
<li>收缩或释放锁阶段</li>
</ul>
<h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><p>备份</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">into</span> outfile <span class="string">&#x27;file_name&#x27;</span> export_options  </span><br><span class="line">              dumpfile <span class="string">&#x27;file_name&#x27;</span></span><br><span class="line">    fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>  逗号分隔</span><br><span class="line">    optionally enclosed <span class="keyword">by</span> &quot;&quot;  字符串用双引号</span><br><span class="line">    lines terminated <span class="keyword">by</span> <span class="string">&#x27;?&#x27;</span>  问号分隔每行数据</span><br></pre></td></tr></table></figure>

<p>dumpfile 导出的备份文件里面所有的数据都彼此紧挨着</p>
<p>导入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">load data infile <span class="string">&#x27;file_name&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> table_name</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>  逗号分隔</span><br><span class="line">    optionally enclosed <span class="keyword">by</span> &quot;&quot;  字符串用双引号</span><br><span class="line">    lines terminated <span class="keyword">by</span> <span class="string">&#x27;?&#x27;</span>  问号分隔每行数据</span><br></pre></td></tr></table></figure>

<p>数据库生命周期</p>
<ul>
<li>需求分析</li>
<li>系统功能与数据库的设计</li>
<li>系统功能与数据库的实现</li>
<li>测试与维护</li>
</ul>
<h4 id="php-mysql应用"><a href="#php-mysql应用" class="headerlink" title="php mysql应用"></a>php mysql应用</h4><p>连接数据库非持久连接</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$con</span> = <span class="title function_ invoke__">mysql_connect</span>(<span class="string">&quot;localhost:3306&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">持久连接 mysql_pconnect</span><br><span class="line"></span><br><span class="line">选择数据库 <span class="title function_ invoke__">mysql_select_db</span>(<span class="string">&quot;test&quot;</span>, <span class="variable">$con</span>)</span><br><span class="line"></span><br><span class="line">执行 sql <span class="title function_ invoke__">mysql_query</span>(<span class="string">&quot;set names &#x27;gbk&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>, <span class="variable">$con</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$array</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$res</span>, MYSQL_NUM);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mysql_close</span>(<span class="variable">$con</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;关闭失败&quot;</span>);</span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://thepatterraining.github.io/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpeg">
      <meta itemprop="name" content="Thepatter">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0.html" class="post-title-link" itemprop="url">学堂在线C++程序设计第十二章学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-23 10:12:47" itemprop="dateCreated datePublished" datetime="2021-08-23T10:12:47+08:00">2021-08-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-26 10:07:53" itemprop="dateModified" datetime="2025-01-26T10:07:53+08:00">2025-01-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          
            <span id="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0.html" class="post-meta-item leancloud_visitors" data-flag-title="学堂在线C++程序设计第十二章学习笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="学堂在线C-程序设计第十二章学习笔记"><a href="#学堂在线C-程序设计第十二章学习笔记" class="headerlink" title="学堂在线C++程序设计第十二章学习笔记"></a>学堂在线C++程序设计第十二章学习笔记</h1><h2 id="泛型程序设计和标准模板库"><a href="#泛型程序设计和标准模板库" class="headerlink" title="泛型程序设计和标准模板库"></a>泛型程序设计和标准模板库</h2><h3 id="泛型及STL"><a href="#泛型及STL" class="headerlink" title="泛型及STL"></a>泛型及STL</h3><p>泛型程序设计</p>
<ul>
<li>编写不依赖于具体数据类型的程序</li>
<li>将算法从特定的数据结构中抽象出来成为通用的</li>
<li>C++的模板为泛型程序设计奠定了关键的基础</li>
</ul>
<p>术语：概念</p>
<ul>
<li>可以比较大小的数据类型记作<code>Comparable</code></li>
<li>具有公有的复制函数并可以用 &#x3D; 赋值的记作<code>Assignable</code></li>
<li>将 可以比较大小 并且 具有公有复制函数可以用 &#x3D; 赋值的记作<code>Sortable</code></li>
</ul>
<p>对于两个不同的概念A，B,如果A所需求的所有功能也是B所需求的，那么B是A的子概念，比如，Sortable是 Comparable 的子概念，也是 Assignable的子概念</p>
<p>术语：模型</p>
<ul>
<li>符合一个概念的数据类型称为该概念的模型</li>
<li>比如 int 型是 Comparable的模型</li>
<li>静态数组不是 Assignable的模型</li>
</ul>
<h4 id="STL"><a href="#STL" class="headerlink" title="STL"></a>STL</h4><ul>
<li>标准模板库STL定义了一套概念体系，为泛型程序设计提供了逻辑基础</li>
<li>STL中的各个类模板，函数模板的参数都是用这个体系中的概念来规定的</li>
<li>使用STL模板时，类型参数既可以是C++标准库中已有的类型，也可以是自定义的类型–只要这些类型是所要求的概念的模型</li>
</ul>
<p>STL基本组件</p>
<ul>
<li>容器（container）：容纳，包含一组元素的对象<ul>
<li>顺序容器：<br>  array,vector,双端队列，单链表，列表</li>
<li>有序容器：<br>  集合，多重集合，map,多重映射</li>
<li>无序关联容器<br>  无序集合，无序多重集合，无序映射，无序多重映射</li>
</ul>
</li>
<li>迭代器（iterator）<ul>
<li>提供了顺序访问容器中每个元素的方法</li>
<li>可以使用 ++ 运算符来获得指向下一个元素的迭代器</li>
<li>可以使用 * 运算符访问迭代器指向的元素，如果元素类型是类或结构体，还可以使用 -&gt; 运算符直接访问成员</li>
<li>有些迭代器还支持通过 – 运算符获得指向上一个元素的迭代器</li>
<li>迭代器是泛化的指针：指针也具有同样的特性，因此指针本身就是一种迭代器</li>
<li>使用独立于STL容器的迭代器，需要包含头文件<iterator></li>
</ul>
</li>
<li>函数对象（function object）</li>
<li>算法（algorithms）</li>
</ul>
<p><code>迭代器</code>是<code>算法</code>和<code>容器</code>的桥梁</p>
<ul>
<li>将迭代器作为算法的参数，通过迭代器来访问容器而不是把容器直接作为算法参数</li>
<li>将<code>函数对象</code>作为算法参数而不是将函数所执行的运算作为算法的一部分。</li>
<li>使用STL中提供的或自定义的迭代器和函数对象，配合STL的算法，可以组合出各种各样的功能</li>
</ul>
<p>容器适配器</p>
<ul>
<li>栈</li>
<li>队列</li>
</ul>
<h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><p>迭代器是算法和容器的桥梁</p>
<ul>
<li>迭代器用作访问容器中的元素</li>
<li>算法不直接操作容器中的数据，而是通过迭代器间接操作</li>
</ul>
<p>算法和容器独立</p>
<ul>
<li>增加新的算法，无需影响容器的实现</li>
<li>增加新的容器，原有的算法也可以适用</li>
</ul>
<p>输入流迭代器</p>
<ul>
<li>istream_iterator<T></li>
<li>以输入流 如 cin 为参数构造</li>
<li>可用 *(p++) 获得下一个输入的元素</li>
</ul>
<p>输出流迭代器</p>
<ul>
<li>ostream_iterator<T></li>
<li>构造时需要提供输出流 如 cout</li>
<li>可用 (*p++) &#x3D; x 将 x 输出到输出流</li>
</ul>
<p>二者都属于适配器</p>
<ul>
<li>适配器是用来为已有对象提供新的接口的对象</li>
<li>输入流适配器和输出流适配器为流对象提供了迭代器的接口</li>
</ul>
<h3 id="容器的基本功能和分类"><a href="#容器的基本功能和分类" class="headerlink" title="容器的基本功能和分类"></a>容器的基本功能和分类</h3><ul>
<li>容器类是容纳，包含一组元素或元素集合的对象</li>
<li>基于容器中元素的组织方式分类：顺序容器，关联容器</li>
<li>按照与容器所关联的迭代器类型分类：可逆容器，随机访问容器</li>
</ul>
<h3 id="顺序容器"><a href="#顺序容器" class="headerlink" title="顺序容器"></a>顺序容器</h3><h5 id="顺序容器的基本功能"><a href="#顺序容器的基本功能" class="headerlink" title="顺序容器的基本功能"></a>顺序容器的基本功能</h5><ul>
<li>STL中的顺序容器<ul>
<li>向量</li>
<li>双端队列(deque)</li>
<li>列表(list)</li>
<li>单向链表(forward_list)</li>
<li>数组(array)</li>
</ul>
</li>
<li>元素线性排列，可以随时在指定位置插入元素和删除元素</li>
<li>必须符合 Assignable 这一概念（具有共有的复制构造函数并可以用 ‘&#x3D;’ 赋值）</li>
<li>array 对象的大小固定，forward_list有特殊的添加和删除操作</li>
</ul>
<p>顺序容器的接口（不包含单向链表和数组）</p>
<ul>
<li>构造函数</li>
<li>赋值函数：assign</li>
<li>插入函数: insert, push_front(只对list和deque)，push_back, emplace, emplace_front</li>
<li>删除函数：erase, clear, pop_front, pop_back, emplace_back</li>
<li>首尾元素的直接访问：front, back</li>
<li>改变大小：resize</li>
</ul>
<h4 id="顺序容器的特征"><a href="#顺序容器的特征" class="headerlink" title="顺序容器的特征"></a>顺序容器的特征</h4><p>向量</p>
<ul>
<li>特点<ul>
<li>一个可以扩展的动态数组</li>
<li>随机访问，在尾部插入或删除元素块</li>
<li>在中间或头部插入或删除元素慢</li>
</ul>
</li>
<li>容量<ul>
<li>容量：实际分配空间的大小</li>
<li>s.capacity: 返回当前容量</li>
<li>s.reserve(n): 容量小于n，则对s进行扩展，使其容量至少为n</li>
</ul>
</li>
</ul>
<p>双端队列</p>
<ul>
<li>特点<ul>
<li>在两端插入或删除元素快</li>
<li>在中间插入或删除元素慢</li>
<li>随机访问较快，但比向量慢</li>
</ul>
</li>
</ul>
<p>列表</p>
<ul>
<li>特点<ul>
<li>在任意位置插入和删除元素都很快</li>
<li>不支持随机访问</li>
</ul>
</li>
<li>接合操作（splice）<ul>
<li>s.splice(p, s2, q1, q2): 将s2中[q1,q2)移动到s1中p所指向元素之前</li>
</ul>
</li>
</ul>
<h4 id="顺序容器的插入迭代器与适配器"><a href="#顺序容器的插入迭代器与适配器" class="headerlink" title="顺序容器的插入迭代器与适配器"></a>顺序容器的插入迭代器与适配器</h4><p>顺序容器的插入迭代器</p>
<ul>
<li>用于向容器头部，尾部或中间指定位置插入元素的迭代器</li>
<li>包括前插迭代器（front_inserter），后插迭代器（back_inserter）和任意位置插入迭代器（inserter）</li>
<li>例子：<br>  list<int> s;<br>  back_iserter iter(s);<br>  *(iter++) &#x3D; 5; &#x2F;&#x2F;通过iter把5插入s末尾</li>
</ul>
<p>顺序容器的适配器</p>
<ul>
<li>以顺序容器为基础构建一些常用数据结构，是对顺序容器的封装<ul>
<li>栈</li>
<li>队列</li>
<li>优先级队列：最 <code>大</code> 的先弹出</li>
</ul>
</li>
</ul>
<p>栈和队列模板</p>
<ul>
<li>栈模板<br>  template &lt;class T, class Sequence &#x3D; deque<T>&gt; class stack;</li>
<li>队列模板<br>  template &lt;class T,class FrontInsertionSequence &#x3D; deque<T>&gt; class queue;</li>
<li>栈可以用任何一种顺序容器作为基础容器，而队列只允许用前插顺序容器（双端队列或列表）</li>
</ul>
<p>栈和队列共同支持的操作</p>
<ul>
<li>比较</li>
<li>返回元素个数</li>
<li>empty</li>
<li>push</li>
<li>pop</li>
<li>不支持迭代器，因为不允许对任意元素访问</li>
</ul>
<p>栈和队列不同的操作</p>
<ul>
<li>栈的操作<br>  s.top 返回栈顶元素的引用</li>
<li>队列操作<br>  s.front 获得队头元素的引用<br>  s.back 获得队尾元素的引用</li>
</ul>
<p>优先级队列</p>
<ul>
<li>优先级队列也像栈和队列一样支持元素的压入和弹出，但元素弹出顺序和元素大小有关，每次弹出最大的</li>
<li>template &lt;class T, class Sequence &#x3D; Vector<T>&gt; class priority_queue</li>
<li>优先级队列的基础容器必须是支持随机访问的顺序容器</li>
<li>支持栈和队列的size,empty, push, pop几个函数</li>
<li>优先级队列并不支持比较操作</li>
<li>与栈类似，优先级队列提供一个 top 函数，可以获得下一个即将被弹出元素的引用</li>
</ul>
<h3 id="关联容器"><a href="#关联容器" class="headerlink" title="关联容器"></a>关联容器</h3><h4 id="分类和基本功能"><a href="#分类和基本功能" class="headerlink" title="分类和基本功能"></a>分类和基本功能</h4><p>关联容器的特点</p>
<ul>
<li>每个关联容器都有一个key</li>
<li>可以根据key高效查找元素</li>
</ul>
<p>接口</p>
<ul>
<li>插入insert</li>
<li>删除 erase</li>
<li>查找 find</li>
<li>定界 lower_bound,upper_bound,equal_bound</li>
<li>计数 count</li>
</ul>
<h4 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h4><p>集合用来存储一组无重复的数据。用于集合的元素本身是有序的，可以高效查找元素，也可以方便的得到指定大小范围的元素在容器中所处的区间</p>
<h4 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h4><p>映射和集合的主要区别</p>
<ul>
<li><p>集合的元素类型是key本身</p>
</li>
<li><p>映射的元素类型是key,value二元组</p>
</li>
<li><p>在集合中按照key查找一个元素时，一般只是确定这个元素是否存在。</p>
</li>
<li><p>映射中按照key查找时，除了能确定是否存在外，还可以得到相应的附加数据</p>
</li>
</ul>
<h4 id="多重集合和多重映射"><a href="#多重集合和多重映射" class="headerlink" title="多重集合和多重映射"></a>多重集合和多重映射</h4><ul>
<li>多重集合允许有重复元素的集合，多重映射允许一个key对应多个value</li>
<li>多重集合与集合，多重映射与映射的用法差不多</li>
</ul>
<h3 id="函数对象"><a href="#函数对象" class="headerlink" title="函数对象"></a>函数对象</h3><p>函数对象</p>
<ul>
<li>一个行为类似函数的对象</li>
<li>可以没有参数，也可以带有若干参数</li>
<li>其功能是获取值，或者改变操作状态</li>
<li>普通函数就是函数对象</li>
<li>重载了 “()” 运算符的类的实例是函数对象</li>
</ul>
<h4 id="函数适配器"><a href="#函数适配器" class="headerlink" title="函数适配器"></a>函数适配器</h4><ul>
<li>绑定适配器<ul>
<li>bind1st, bind2nd: 将n元函数对象的指定参数绑定为一个常数，得到n-1元函数对象</li>
</ul>
</li>
<li>组合适配器<ul>
<li>not1,not2: 将指定谓词的结果取反</li>
</ul>
</li>
<li>函数指针适配器<ul>
<li>ptr_fun: 将一般函数指针转换为函数对象，使之能够作为其他函数适配器的输入</li>
<li>在进行参数绑定或其他转换的时候，通常需要函数对象的类型信息</li>
</ul>
</li>
<li>成员函数适配器:ptr_fun,ptr_fun_ref<ul>
<li>对成员函数指针使用，把n元成员函数适配为n + 1元函数对象，该函数对象的第一个参数为调用该成员函数时的目的对象</li>
<li>也就是 object-&gt;method() 变成 method(object)</li>
<li>将 object-&gt;method(arg1) 变成 method(object, arg1)</li>
</ul>
</li>
</ul>
<h4 id="STL算法"><a href="#STL算法" class="headerlink" title="STL算法"></a>STL算法</h4><p>本身是一种函数模板</p>
<ul>
<li>通过迭代器获得输入数据</li>
<li>通过函数对象对数据进行处理</li>
<li>通过迭代器将结果输出</li>
</ul>
<p>STL算法是通用的，独立于具体的数据类型，容器类型</p>
<p>分类</p>
<ul>
<li>不可变序列算法<ul>
<li>不直接修改所操作的容器内容的算法</li>
<li>用于查找指定元素，比较是否相等，对元素进行计数等</li>
</ul>
</li>
<li>可变序列算法<ul>
<li>可修改所操作的容器对象的算法</li>
<li>包括复制，删除，替换，洗牌及生成一个序列的算法</li>
</ul>
</li>
<li>排序和搜索算法<ul>
<li>对序列排序</li>
<li>搜索</li>
<li>堆算法</li>
</ul>
</li>
<li>数值算法<ul>
<li>求和，求差，积等</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Thepatter"
      src="/images/header.jpeg">
  <p class="site-author-name" itemprop="name">Thepatter</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">210</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">83</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Thepatterraining" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Thepatterraining" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ztzhoutao041@163.com" title="E-Mail → mailto:ztzhoutao041@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://blog.csdn.net/Thepatterraining" title="CSDN → http:&#x2F;&#x2F;blog.csdn.net&#x2F;Thepatterraining" rel="noopener" target="_blank"><i class="fa fa-fw fa-CSDN"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Thepatter</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"RWllimOI5okO7WFTUmJ4EeeD-gzGzoHsz","app_key":"hXeefwCw8aDKTJ1Xqye7fLYb","security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'RWllimOI5okO7WFTUmJ4EeeD-gzGzoHsz',
      appKey     : 'hXeefwCw8aDKTJ1Xqye7fLYb',
      placeholder: "给我的文章加点评论吧~",
      avatar     : 'mp',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
